var Z=Object.defineProperty;var Q=Object.getOwnPropertySymbols;var ee=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var V=(u,e,o)=>e in u?Z(u,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):u[e]=o,C=(u,e)=>{for(var o in e||(e={}))ee.call(e,o)&&V(u,o,e[o]);if(Q)for(var o of Q(e))te.call(e,o)&&V(u,o,e[o]);return u};import{Q as se}from"./QImg.1b5eb173.js";import{_ as ae,at as re,as as oe,r as R,c as le,w as ie,u as y,ad as w,ae as l,v as ne,d as r,ah as q,y as m,a$ as b,aj as j,b4 as ue,b0 as L,b1 as n,b as O,ag as D,b2 as ce,av as de,b3 as me}from"./index.c9236ec1.js";import{Q as pe}from"./QForm.2ef570c2.js";import{Q as fe}from"./QPage.b09575ae.js";import{a as ve,e as ge,c as A,d as ye,b as be,u as S}from"./array.3b777f89.js";import{u as he}from"./i18n.a45b1307.js";import{u as _e,e as we,c as qe,q as i}from"./quickbase.29b5324a.js";import{_ as Ie}from"./languageSelector.154b0672.js";import{c as Ue}from"./carousel.1ebbc523.js";import"./_commonjsHelpers.d497b07e.js";import"./dayjs.a966b485.js";import"./localForage.6f68d00d.js";import"./index.7dbe61ef.js";import"./QSelect.96dbe665.js";import"./QMenu.ba98fc20.js";import"./position-engine.99d41629.js";import"./selection.93193720.js";import"./use-quasar.4f96b1b6.js";import"./use-panel.99195854.js";import"./touch.6a3c5155.js";const xe={key:0,class:"col-md-7 col-lg-8 col-lx-8"},ke={class:"col-xs-12 col-sm-12 col-md-5 col-lg-4 col-lx-4 row justify-center items-center"},Ce={class:"text-dark"},Re={class:"row"},De={class:"row"},Se={class:"text-grey-6"},$e={class:"row justify-center"},Me={__name:"verifyIdentity",setup(u){const e=_e(),{employeeData:o,socialRequired:$,updateEmployeeData:B,setEmployee:X}=we(),F=qe(),p=re(),f=oe(),{t:M}=he(),h=R(!1),I=R("confirm-identity"),T=le(()=>ve({userRID:ge().required(),ssn:A().required().matches(/^[0-9]{9}/g,{excludeEmptyString:!0,message:`${M("nineDigitsRequired")}`}).nullable(),ssnConfirmation:A().oneOf([ye("ssn"),null],`${M("socialSecurityNumberMustMatch")}`).required().nullable()})),{errors:Ne,meta:Y}=be({validationSchema:T,initialValues:{ssn:"",ssnConfirmation:""}}),{value:v}=S("userRID"),{value:c,errorMessage:N,meta:P}=S("ssn"),{value:g,errorMessage:E,meta:H}=S("ssnConfirmation"),_=R(!0);p.query.rid?(v.value=p.query.rid,c.value="",g.value="",f.replace({query:{}})):f.push("/"),ie(()=>p.query,()=>{p.query.rid&&(v.value=p.query.rid,c.value="",g.value="",f.replace({query:{}}))});const z=async()=>{const t=i.getOfficeLocation(),s=[{20:{value:e.getUser[35]},22:{value:e.getUser[37]},109:{value:c.value},25:{value:e.getUser[9]?e.getUser[9].phoneNumber:e.getUser[8].replace(/[^0-9]/g,"")},28:{value:e.getUser[50]?"Yes":"No"},26:{value:e.getUser[6]},34:{value:e.getUser[49]?"Yes":"No"},16:{value:t?t.rid:""}}],{data:a}=await i.upsertRecordsXML({to:"bp3gb7ng2",fieldsToReturn:[500],data:s,formatObject:500}),d=a[0][500];return e.userLoggedIn&&X(d,!0),d[3]},U=async t=>{const s=i.getOfficeLocation(),a=C({3:{value:t},20:{value:e.getUser[35]},22:{value:e.getUser[37]},109:{value:c.value},25:{value:e.getUser[9]?e.getUser[9].phoneNumber:e.getUser[8].replace(/[^0-9]/g,"")},28:{value:e.getUser[50]?"Yes":"No"},26:{value:e.getUser[6]},34:{value:e.getUser[49]?"Yes":"No"}},s&&{16:{value:s.rid}});return(await B({fields:a}))[3]},G=async t=>{const s=[{3:{value:e.getUser[86]},16:{value:t}}],{data:a}=await i.upsertRecordsXML({to:"br26nivmr",fieldsToReturn:[76],data:s,formatObject:76});return i.setCheckInData(a[0][76]),a[3]},J=async()=>{const s=[{8:{value:`{'188'.EX.'${c.value}'}AND{'509'.EX.'false'}`},7:{value:"Employees"},9:{value:12}}],{data:a}=await i.fetchFromHiringApp({fields:s});return a[0]?a[0][3]:null},K=async()=>{if(!v.value||v.value==="")return!1;h.value=!0;let t=await J();const s=new Date,a=[{3:{value:v.value},26:{value:s}}];$&&t?(await i.softDeleteEmployee(o[3]),await U(t)):$&&!t?t=await U(o[3]):t?await U(t):t||(t=await z()),F.checkedIn&&G(t),a[0][80]={value:t},a[0][85]={value:!1};try{const{data:d}=await i.upsertRecordsXML({to:"br4pxrbs6",fieldsToReturn:[76],data:a,formatObject:76}),x=d[0][76];if(e.userLoggedIn){const k=Object.assign({},x);delete k.access,delete k.permissions,i.setUserPermissions(x.permissions,!0),i.setUserAccess(x.access,!0),await i.setUserInfo(k,!0)}h.value=!1,f.push({path:"/",query:C({verify:!0},t&&{rid:t})})}catch(d){h.value=!1,console.log(d)}},W=()=>{e.logout().then(()=>{f.replace({name:"login"})})};return(t,s)=>(y(),w(fe,{class:"window-height window-width row"},{default:l(()=>[t.$q.screen.lt.md?q("",!0):(y(),ne("div",xe,[r(Ue)])),m("div",ke,[r(me,{class:"auth-card",flat:""},{default:l(()=>[r(b,{style:{"padding-left":"30px","padding-right":"30px"}},{default:l(()=>[r(se,{src:"https://cdn.jsdelivr.net/gh/EliteHCMS/assets@latest/public/logo.svg",fit:"scale-down",class:"auth-logo full-width"})]),_:1}),r(b,{class:"text-center auth-description"},{default:l(()=>[m("p",Ce,j(t.$t("pleaseVerifyInfoToCompleteRegistration")),1)]),_:1}),r(b,null,{default:l(()=>[r(pe,{class:"q-px-sm q-pt-sm",onSubmit:s[3]||(s[3]=ue(()=>{},["prevent"]))},{default:l(()=>[m("div",Re,[I.value==="confirm-identity"?(y(),w(L,{key:0,class:"col-xs-12",outlined:"",mask:"#########",modelValue:n(c),"onUpdate:modelValue":s[0]||(s[0]=a=>O(c)?c.value=a:null),maxlength:"9",minlength:"9",type:"password",label:t.$t("socialSecurityNumber"),tabindex:"1",error:!!(n(N)&&n(P).validated),"error-message":n(N)},{prepend:l(()=>[r(D,{name:"lock"})]),_:1},8,["modelValue","label","error","error-message"])):q("",!0)]),m("div",De,[I.value==="confirm-identity"?(y(),w(L,{key:0,class:"col-xs-12",outlined:"",mask:"#########",modelValue:n(g),"onUpdate:modelValue":s[2]||(s[2]=a=>O(g)?g.value=a:null),maxlength:"9",minlength:"9",type:_.value?"password":"text",label:t.$t("confirmSSN"),tabindex:"2",error:!!(n(E)&&n(H).validated),"error-message":n(E)},{prepend:l(()=>[r(D,{name:"lock"})]),append:l(()=>[r(D,{name:_.value?"visibility_off":"visibility",class:"cursor-pointer",onClick:s[1]||(s[1]=a=>_.value=!_.value)},null,8,["name"])]),_:1},8,["modelValue","type","label","error","error-message"])):q("",!0)])]),_:1})]),_:1}),r(ce,{class:"q-px-lg"},{default:l(()=>[I.value==="confirm-identity"?(y(),w(de,{key:0,loading:h.value,disable:!n(Y).valid,unelevated:"",size:"lg",color:"primary",class:"full-width text-white",label:t.$t("confirm"),tabindex:"3",onClick:K},null,8,["loading","disable","label"])):q("",!0)]),_:1}),r(b,{class:"text-center q-pa-sm"},{default:l(()=>[m("p",Se,[m("a",{onClick:W,class:"text-grey-6",href:"javascript:void(0);",tabindex:"4"},j(t.$t("logout")),1)])]),_:1}),r(b,{class:"q-pl-lg q-pa-sm"},{default:l(()=>[m("div",$e,[r(Ie,{dense:"",borderless:""})])]),_:1})]),_:1})])]),_:1}))}};var tt=ae(Me,[["__scopeId","data-v-f511c8d0"]]);export{tt as default};
