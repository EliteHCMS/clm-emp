var q=Object.defineProperty;var c=Object.getOwnPropertySymbols;var h=Object.prototype.hasOwnProperty,w=Object.prototype.propertyIsEnumerable;var d=(t,i,e)=>i in t?q(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e,m=(t,i)=>{for(var e in i||(i={}))h.call(i,e)&&d(t,e,i[e]);if(c)for(var e of c(i))w.call(i,e)&&d(t,e,i[e]);return t};import{f as b}from"./index.f9748b21.js";import{l as I}from"./index.5ba7d8c6.js";import{z as v,a as y,q as a,b as L}from"./quickbase.165ec50c.js";import"./_commonjsHelpers.d497b07e.js";import"./dayjs.36de73c7.js";import"./localForage.7ffb4e17.js";import"./index.7dbe61ef.js";import"./i18n.ebfed6a6.js";const R=t=>t.matched.some(i=>y.can(i.meta.action||"read",i.meta.resource));var E=b(({app:t,router:i})=>{t.config.globalProperties.$subject=v,t.use(I,y,{useGlobalProperties:!0}),i.beforeEach(async(e,n,r)=>{const f=await a.isUserLoggedIn(),s=Object.assign({},e.query);if(f||a.logout(),s.office_id&&(a.setOfficeLocation({rid:s.office_id}),s.qr&&a.setCheckIn(!0)),n.fullPath==="/"&&!n.name&&(f?await a.reloadUserInfo({reAuthenticate:!0}):L.userType==="Candidate Kiosk"&&await a.updateStore()),!R(e)){const g=e.path!=="/";return r(f?{name:"not-authorized"}:{name:"login",query:m({},g&&{redirect:e.path})})}if(e.meta.redirectIfLoggedIn&&f)return r("/");const l=await a.verifyRequired(),u=await a.employeeLinkRequired(),o=await a.getUserFromStore(),p=await a.getSocialRequired();if(l)return n.name==="code-confirmation"&&f&&e.query.code?(await a.setVerified(!0),r({path:"/"})):e.name!=="code-confirmation"?r({name:"code-confirmation",query:{p:o[9]?o[9].phoneNumber:o[8].replace(/[^0-9]/g,""),rid:o[3]}}):r();if(u||p)return n.name==="verify-identity"&&f&&e.query.verify?(e.query.rid?await a.setIdentityVerified(e.query.rid):await a.setIdentityVerified(!1),r({path:"/",query:{}})):e.name!=="verify-identity"?r({name:"verify-identity",query:{rid:o[3]}}):r();if(e.name==="verify-identity"){if(!u)return r({path:"/"})}else if(e.name==="code-confirmation")return!f&&e.query.ac?r():r({path:"/"});return r()}),i.afterEach(async(e,n)=>{const r=await a.isUserLoggedIn();n.fullPath==="/"&&!n.name&&r&&await a.updateStore({reAuthenticate:!1})})});export{E as default};
