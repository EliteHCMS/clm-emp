var ne=Object.defineProperty;var O=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var Y=(l,o,t)=>o in l?ne(l,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[o]=t,T=(l,o)=>{for(var t in o||(o={}))ie.call(o,t)&&Y(l,t,o[t]);if(O)for(var t of O(o))ue.call(o,t)&&Y(l,t,o[t]);return l};import{Q as de}from"./QImg.6c705cb3.js";import{_ as ce,at as me,as as pe,r as n,c as I,w as b,aq as Q,u as p,ad as w,ae as r,v as G,d as s,ah as g,y as k,a_ as q,aj as P,b3 as ve,b4 as ge,a$ as J,bz as fe,au as L,ag as U,z as he,b1 as ye,ai as z,b2 as be,a9 as j}from"./index.783c3705.js";import{Q as we}from"./QForm.36af7ff0.js";import{Q as _e}from"./QPage.0f9498bf.js";import{u as xe}from"./use-quasar.ef99e846.js";import{c as M,u as B}from"./array.2d486e63.js";import{p as Ce}from"./VueTelInput.1c9b3d4a.js";import{_ as ke}from"./languageSelector.c64a36e6.js";import{c as qe}from"./carousel.e745c542.js";import{q as W}from"./quickbase.f6d2e685.js";import{u as Pe}from"./i18n.bc210a44.js";import"./_commonjsHelpers.d497b07e.js";import"./QSelect.ee5dd839.js";import"./QMenu.684788af.js";import"./position-engine.b9a026e2.js";import"./selection.4146783e.js";import"./use-panel.a246499b.js";import"./touch.6a3c5155.js";import"./dayjs.b434911a.js";import"./localForage.c7c15238.js";import"./index.7dbe61ef.js";const Me={name:"Login",components:{phoneNumberInput:Ce,carousel:qe,languageSelector:ke},setup(){const l=xe(),o=me(),t=pe(),{locale:e,t:_}=Pe(),u=n(!1),i=n(!1),x=n(10),c=n(!1),v=n(null),d=n(!1),X=n("first"),f=n("username"),K=n(null),V=n(null),N=n(!1),S=n(!1);o.query.redirect&&(V.value=o.query.redirect,t.replace({query:{}}));const $=I(()=>u.value?M().email(`${_("validEmailIsRequired")}`).nullable():M().email(`${_("validEmailIsRequired")}`).nullable()),ee=I(()=>{if(i.value)return M().nullable();{const a=new RegExp("^[0-9]{"+x.value+"}","g");return M().matches(a,{excludeEmptyString:!0,message:`${_("validPhoneIsRequired")}`}).nullable()}}),ae=I(()=>M().required().matches(/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d@$!%*#?&]{8,}$/,{excludeEmptyString:!0,message:`${_("passwordRules")}`}).nullable()),{errorMessage:R,value:C}=B("email",$),{errorMessage:A,value:h}=B("phone",ee),{errorMessage:D,value:y}=B("password",ae),le=n(!0);b(R,a=>{a||C.value===""?i.value=!1:i.value=!0}),b(C,a=>{!a||a===""?i.value=!1:/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/.test(a)&&!R.value&&(i.value=!0)}),b(A,a=>{a||h.value===""?u.value=!1:u.value=!0}),b(h,a=>{!a||a===""?u.value=!1:a.length===x.value&&!A.value&&(u.value=!0)}),b(D,a=>{a||y.value===""?c.value=!1:c.value=!0}),b(y,a=>{d.value=!1,(!a||a==="")&&(c.value=!1)});const oe=a=>{x.value=a},F=I(()=>!(u.value||i.value)),se=a=>{v.value=a},te=()=>{f.value="username",y.value=null,j(()=>{document.querySelector("#email").focus()})},re=()=>{f.value="username",y.value=null,j(()=>{document.querySelector("#phoneNumber").focus()})},Z=async()=>{S.value=!0;const a={userType:"Candidate"};u.value?a.phoneNumber=`+${v.value?v.value.dialCode:"1"}${h.value}`:i.value&&(a.email=C.value);try{const m=await W.checkIfUserExist(a);S.value=!1,m?(f.value="password",j(()=>{document.querySelector("#password").focus()})):t.push({name:"register",params:T(T({},u.value&&{phoneTemp:h.value}),i.value&&{emailTemp:a.email})})}catch(m){S.value=!1,console.log(m)}},H=async()=>{N.value=!0,clearTimeout(K.value);const a={password:y.value,userType:"Candidate"};u.value?a.phoneNumber=`+${v.value?v.value.dialCode:"1"}${h.value}`:i.value&&(a.email=C.value);try{const m=await W.login(a);N.value=!1,m&&(V.value?t.push(V.value):t.push({path:"/"}))}catch(m){N.value=!1,K.value=setTimeout(function(){d.value=!1},7e3);const{response:E}=m;E&&E.data.errtext&&E.data.errdetail?l.notify({type:"negative",message:E.data.errdetail,timeout:7e3,position:l.screen.lt.md?"top":"top-right"}):(console.log(m),l.notify({type:"negative",message:"An error occurred, please try again later",timeout:7e3,position:l.screen.lt.md?"top":"top-right"}))}};return{email:C,phone:h,password:y,isPwd:le,validPhone:u,validEmail:i,step:f,validPassword:c,invalidLogin:d,continueProgress:S,loginProgress:N,passwordMessage:D,phoneMessage:A,emailMessage:R,userNameInvalid:F,updatePhoneMaxLength:oe,continueAction:Z,editUserNameEmail:te,editUserNamePhoneNumber:re,slide:X,login:H,updateCountry:se,onSubmit:a=>{f.value==="username"&&!F.value?Z():f.value==="password"&&!(!c.value||d.value)?H():a.preventDefault()},locale:e}}},Ne={key:0,class:"col-md-7 col-lg-8 col-lx-8"},Se={class:"col-xs-12 col-sm-12 col-md-5 col-lg-4 col-lx-4 row justify-center items-center"},Ee={class:"text-dark"},Ie={key:1,class:"divider"},Qe={class:"divider-text"},Ve={class:"text-grey-6",tabindex:"4"},Re={class:"row justify-center"};function Ae(l,o,t,e,_,u){const i=Q("carousel"),x=Q("phone-number-input"),c=Q("router-link"),v=Q("languageSelector");return p(),w(_e,{class:"window-height window-width row"},{default:r(()=>[l.$q.screen.lt.md?g("",!0):(p(),G("div",Ne,[s(i)])),k("div",Se,[s(be,{class:"auth-card",flat:""},{default:r(()=>[s(q,{style:{"padding-left":"30px","padding-right":"30px"}},{default:r(()=>[s(de,{src:"https://cdn.jsdelivr.net/gh/EliteHCMS/assets@latest/public/logo.svg",fit:"scale-down",class:"auth-logo full-width"})]),_:1}),s(q,{class:"text-center auth-description"},{default:r(()=>[k("p",Ee,P(l.$t("pleaseSignInToYourAccount")),1)]),_:1}),s(q,null,{default:r(()=>[s(we,{class:"q-px-sm q-pt-sm",onSubmit:o[4]||(o[4]=ve(()=>{},["prevent"])),onKeyup:ge(e.onSubmit,["enter"])},{default:r(()=>[!e.validEmail&&!e.validPhone||e.validEmail?(p(),w(J,{key:0,for:"email",style:{"padding-bottom":"0px"},autocomplete:"username",clearable:"",outlined:"",modelValue:e.email,"onUpdate:modelValue":o[0]||(o[0]=d=>e.email=d),type:"email",label:l.$t("email"),tabindex:"1",error:!!e.emailMessage,"error-message":e.emailMessage,readonly:e.step!=="username"},fe({prepend:r(()=>[s(U,{name:"email"})]),_:2},[e.step!=="username"?{name:"append",fn:r(()=>[s(L,{round:"",dense:"",flat:"",icon:"edit",onClick:e.editUserNameEmail},null,8,["onClick"])])}:void 0]),1032,["modelValue","label","error","error-message","readonly"])):g("",!0),!e.validEmail&&!e.validPhone?(p(),G("div",Ie,[k("div",Qe,P(l.$t("or")),1)])):g("",!0),!e.validEmail&&!e.validPhone||e.validPhone?(p(),w(x,{key:2,outlined:"",for:"phoneNumber",modelValue:e.phone,"onUpdate:modelValue":o[1]||(o[1]=d=>e.phone=d),label:l.$t("phoneNumber"),tabindex:"1",autocomplete:"username",onMaxLengthChanged:e.updatePhoneMaxLength,style:he(e.phoneMessage?"padding-bottom: 20px;":"padding-bottom: 0px;"),error:!!e.phoneMessage,"error-message":e.phoneMessage,readonly:e.step!=="username",editIcon:e.step!=="username",onEditClicked:e.editUserNamePhoneNumber,onCountryChanged:e.updateCountry},null,8,["modelValue","label","onMaxLengthChanged","style","error","error-message","readonly","editIcon","onEditClicked","onCountryChanged"])):g("",!0),e.step==="password"?(p(),w(J,{key:3,for:"password",class:"q-mt-lg",outlined:"",modelValue:e.password,"onUpdate:modelValue":o[3]||(o[3]=d=>e.password=d),type:e.isPwd?"password":"text",label:l.$t("password"),autocomplete:"current-password",tabindex:"2",error:!!e.passwordMessage,"error-message":e.passwordMessage},{append:r(()=>[s(U,{name:e.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:o[2]||(o[2]=d=>e.isPwd=!e.isPwd)},null,8,["name"])]),prepend:r(()=>[s(U,{name:"lock"})]),_:1},8,["modelValue","type","label","error","error-message"])):g("",!0)]),_:1},8,["onKeyup"])]),_:1}),s(ye,{class:"q-px-lg"},{default:r(()=>[e.step==="username"?(p(),w(L,{key:0,loading:e.continueProgress,unelevated:"",size:"lg",color:"primary",class:"full-width text-white",label:l.$t("continue"),tabindex:"3",disabled:e.userNameInvalid,onClick:e.continueAction},null,8,["loading","label","disabled","onClick"])):g("",!0),e.step==="password"?(p(),w(L,{key:1,loading:e.loginProgress,unelevated:"",size:"lg",color:"primary",class:"full-width text-white",label:l.$t("login"),tabindex:"3",disabled:!e.validPassword||e.invalidLogin,onClick:e.login},null,8,["loading","label","disabled","onClick"])):g("",!0)]),_:1}),s(q,{class:"text-center q-pa-sm"},{default:r(()=>[k("p",Ve,[z(P(l.$t("needAnAccountQuestion"))+" ",1),s(c,{to:"/register",class:"text-grey-6"},{default:r(()=>[z(P(l.$t("register")),1)]),_:1})]),s(c,{to:"/forgot-password",class:"text-grey-6"},{default:r(()=>[z(P(l.$t("forgotPasswordQuestion")),1)]),_:1})]),_:1}),s(q,{class:"q-pl-lg q-pa-sm"},{default:r(()=>[k("div",Re,[s(v,{dense:"",borderless:""})])]),_:1})]),_:1})])]),_:1})}var ta=ce(Me,[["render",Ae],["__scopeId","data-v-1b5a6103"]]);export{ta as default};
