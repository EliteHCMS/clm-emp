var q=Object.defineProperty;var c=Object.getOwnPropertySymbols;var h=Object.prototype.hasOwnProperty,w=Object.prototype.propertyIsEnumerable;var d=(t,i,e)=>i in t?q(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e,m=(t,i)=>{for(var e in i||(i={}))h.call(i,e)&&d(t,e,i[e]);if(c)for(var e of c(i))w.call(i,e)&&d(t,e,i[e]);return t};import{f as b}from"./index.33315d06.js";import{l as I}from"./index.87298f10.js";import{z as v,a as y,q as a,b as L}from"./quickbase.ce7a1496.js";import"./_commonjsHelpers.d497b07e.js";import"./dayjs.5943506b.js";import"./localForage.80cdaedd.js";import"./index.7dbe61ef.js";import"./i18n.49c5cd80.js";const R=t=>t.matched.some(i=>y.can(i.meta.action||"read",i.meta.resource));var E=b(({app:t,router:i})=>{t.config.globalProperties.$subject=v,t.use(I,y,{useGlobalProperties:!0}),i.beforeEach(async(e,f,r)=>{const n=await a.isUserLoggedIn(),s=Object.assign({},e.query);if(n||a.logout(),s.office_id&&(a.setOfficeLocation({rid:s.office_id}),s.qr&&a.setCheckIn(!0)),f.fullPath==="/"&&!f.name&&(n?await a.reloadUserInfo({reAuthenticate:!0}):L.userType==="Candidate Kiosk"&&await a.updateStore()),!R(e)){const g=e.path!=="/";return r(n?{name:"not-authorized"}:{name:"login",query:m({},g&&{redirect:e.path})})}if(e.meta.redirectIfLoggedIn&&n)return r("/");const l=await a.verifyRequired(n),u=await a.employeeLinkRequired(n),o=await a.getUserFromStore(n),p=await a.getSocialRequired(n);if(l)return f.name==="code-confirmation"&&n&&e.query.code?(await a.setVerified(!0),r({path:"/"})):e.name!=="code-confirmation"?r({name:"code-confirmation",query:{p:o[9]?o[9].phoneNumber:o[8].replace(/[^0-9]/g,""),rid:o[3]}}):r();if(u||p)return f.name==="verify-identity"&&n&&e.query.verify?(e.query.rid?await a.setIdentityVerified(e.query.rid):await a.setIdentityVerified(!1),r({path:"/",query:{}})):e.name!=="verify-identity"?r({name:"verify-identity",query:{rid:o[3]}}):r();if(e.name==="verify-identity"){if(!u)return r({path:"/"})}else if(e.name==="code-confirmation")return!n&&e.query.ac?r():r({path:"/"});return r()}),i.afterEach(async(e,f)=>{const r=await a.isUserLoggedIn();f.fullPath==="/"&&!f.name&&r&&await a.updateStore({reAuthenticate:!1})})});export{E as default};
