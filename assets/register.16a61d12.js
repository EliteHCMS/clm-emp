import{Q as Be}from"./QImg.56149716.js";import{_ as $e,at as Fe,r as n,c as de,w as Z,ar as L,v as b,ae as x,af as s,x as me,d as a,ai as q,z as c,b0 as i,ak as p,b5 as Xe,b6 as ze,b1 as _,ah as A,B as He,b3 as G,aw as I,aj as S,b4 as J,a3 as Y,b7 as Ke}from"./index.cb92c794.js";import{Q as We}from"./QForm.e890c89a.js";import{Q as Ze}from"./QPage.207a22c3.js";import{C as ee}from"./ClosePopup.773c9d68.js";import{u as Ge}from"./use-quasar.8fa119a6.js";import{a as Je,c as y,d as Ye,b as ea,u as w}from"./array.369b6246.js";import{u as aa}from"./i18n.bd92f726.js";import{p as oa}from"./VueTelInput.bbe6d04b.js";import{_ as ta}from"./languageSelector.28d2f719.js";import{c as sa}from"./carousel.dbb29d7b.js";import{k as ue,q as f}from"./quickbase.239eee4e.js";import{api as la}from"./api.b25366a4.js";import{dayjs as ae}from"./dayjs.c0b635fc.js";import"./_commonjsHelpers.d497b07e.js";import"./QSelect.8e46e197.js";import"./QMenu.b360dd06.js";import"./position-engine.d20b3292.js";import"./selection.66e293c5.js";import"./use-panel.c88f157b.js";import"./touch.6a3c5155.js";import"./localForage.35f24382.js";import"./index.7dbe61ef.js";const ra={name:"Register",props:["phoneTemp","emailTemp"],components:{phoneNumberInput:oa,carousel:sa,languageSelector:ta},setup(l){const t=Ge(),oe=Fe(),{t:e}=aa(),P=n(!1),E=n(!1),U=n(10),m=n(null),B=n(!1),$=n("phoneNumber"),r=n("register"),T=n(!1),ce=n(!1),R=n([]),F=n(!1),te=n(!1),h=n(null),V=n(null),N=n(0),pe=de(()=>{const o=new RegExp("^[0-9]{"+U.value+"}","g");return Je({firstName:y().required().label(`${e("firstName")}`),lastName:y().required().label(`${e("lastName")}`),email:y().email(`${e("validEmailIsRequired")}`).required().label(`${e("email")}`),phoneNumber:y().matches(o,{excludeEmptyString:!0,message:`${e("validPhoneIsRequired")}`}).required().label(`${e("phoneNumber")}`),password:y().required().matches(/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d@$!%*#?&]{8,}$/,{excludeEmptyString:!0,message:`${e("passwordRules")}`}).nullable(),passwordConfirmation:y().oneOf([Ye("password"),null],`${e("passwordMustMatch")}`)})}),fe=de(()=>H.value===h.value),{errors:ve,meta:se}=ea({validationSchema:pe,initialValues:{firstName:"",lastName:"",phoneNumber:"",email:"",password:"",passwordConfirmation:""}}),{value:le,errorMessage:ge,meta:be}=w("firstName"),{value:re,errorMessage:he,meta:ye}=w("lastName"),{value:d,errorMessage:we,setErrors:X,meta:Ne}=w("phoneNumber"),{value:Q,errorMessage:Ce,setErrors:ne,meta:Me}=w("email"),{value:z,errorMessage:xe,meta:qe}=w("password"),{value:_e,errorMessage:Ae,meta:Ie}=w("passwordConfirmation"),{value:H,errorMessage:Pe,meta:Ve}=w("codeConfirmation",y().matches(/^[0-9]{6}/g,{excludeEmptyString:!0,message:`${e("validPhoneIsRequired")}`}).required().oneOf([h.value],`${e("codeMustMatch")}`)),ke=n(!0);l.phoneTemp&&(d.value=l.phoneTemp),l.emailTemp&&(Q.value=l.emailTemp);const De=o=>{U.value=o};Z(d,o=>{R.value.includes(o)&&(X(`${e("phoneNumberAlreadyInUse")}`),R.value.push(d.value),P.value=!1,t.notify({type:"negative",message:`${e("phoneNumberAlreadyInUse")}`,timeout:7e3,position:t.screen.lt.md?"top":"top-right"}),T.value=!0)}),Z(N,o=>{o===0&&(h.value=null,V.value=null),F.value=!0}),Z(H,async o=>{Number(o)===h.value&&(te.value=!0,await Le(),await K())});const Se=o=>{m.value=o},Ee=async()=>{h.value=Math.floor(1e5+Math.random()*9e5),await la.createMessageQueue({to:d.value,messagingServiceSid:"MGd0e31773980318b7cdc5d2043117e27c",message:`${e("yourBrandSafwayVerificationCodeIs")} ${h.value}`,extRef:null,massText:!1}),V.value=ae().add(1,"minute"),Ue()},Ue=()=>{const o=setInterval(()=>{N.value=ae(V.value).valueOf()-ae().valueOf(),N.value<=0&&(N.value=0,clearInterval(o))},1e3)},Te=()=>{T.value=!1,F.value=!1,h.value=null,V.value=null,N.value=0},Re=o=>{const v=Math.floor(o/6e4),u=(o%6e4/1e3).toFixed(0);return v+":"+(u<10?"0":"")+u},Qe=async o=>{const u=[{8:{value:`{'20'.CT.'${o[35]}'}AND{'22'.CT.'${o[37]}'}AND({'24'.CT.'${o[35]}'}AND{'24'.CT.'${o[37]}'})AND({'27'.EX.'${m.value?m.value.dialCode:"1"}${d.value}'}OR{'27'.EX.'${d.value}'})AND{'26'.EX.'${o[6]}'}AND{'509'.EX.'false'}`},7:{value:"Employees"},9:{value:12}}],{data:C}=await f.fetchFromHiringApp({fields:u});return C[0]?C[0][3]:null},je=async o=>{const v=await f.isUserLoggedIn(),u=await Qe(o),C=new Date,M=[{3:{value:o[3]},26:{value:C}}];if(u)M[0][80]={value:u};else return!1;try{const{data:k}=await f.upsertRecordsXML({to:"br4pxrbs6",fieldsToReturn:[76],data:M,formatObject:76}),D=k[0][76];if(v){const g=Object.assign({},D);delete g.access,delete g.permissions,f.setUserPermissions(D.permissions,!0),f.setUserAccess(D.access,!0),await f.setUserInfo(g,!0)}}catch(k){console.log(k)}},Oe=async o=>{const v={password:z.value,userType:"Candidate",phoneNumber:`+${m.value?m.value.dialCode:"1"}${d.value}`};try{if(await f.login(v))return await je(o),oe.push({path:"/"})}catch(u){console.log(u)}},K=async()=>{const o=Q.value.match(/^([^@]*)@/)[1],v=await ue.genSalt(10),u=ue.hashSync(z.value,v),C=Math.floor(1e5+Math.random()*9e5),M=new Date,k=Object.assign({phoneNumber:d.value},m.value),D=[{6:{value:Q.value},7:{value:u},8:{value:`+${m.value?m.value.dialCode:"1"}${d.value}`},9:{value:JSON.stringify(k)},10:{value:"Active"},11:{value:7},21:{value:C},32:{value:"Candidate"},35:{value:le.value.trim()},37:{value:re.value.trim()},23:{value:0},24:{value:0},25:{value:M},26:{value:M},33:{value:o},50:{value:te.value}}];try{const{data:g,metadata:ie}=await f.upsertRecordsXML({to:"br4pxrbs6",fieldsToReturn:[76],data:D,formatObject:76});if(ie.lineErrors){const j=ie.lineErrors[1];let W=!1;j.forEach(O=>{O.includes('is not unique for unique formula field with ID "27"')&&(ne(`${e("emailAlreadyInUse")}`),E.value=!1,t.notify({type:"negative",message:`${e("emailAlreadyInUse")}`,timeout:7e3,position:t.screen.lt.md?"top":"top-right"})),O.includes('The field named "uniqueEmail" with field id 27 requires a unique value.')&&(ne(`${e("emailAlreadyInUse")}`),E.value=!1,t.notify({type:"negative",message:`${e("emailAlreadyInUse")}`,timeout:7e3,position:t.screen.lt.md?"top":"top-right"})),O.includes('is not unique for unique formula field with ID "28"')&&(W=!0,X(`${e("phoneNumberAlreadyInUse")}`),R.value.push(d.value),P.value=!1,t.notify({type:"negative",message:`${e("phoneNumberAlreadyInUse")}`,timeout:7e3,position:t.screen.lt.md?"top":"top-right"})),O.includes('The field named "uniquePhoneNumber" with field id 28 requires a unique value.')&&(W=!0,X(`${e("phoneNumberAlreadyInUse")}`),R.value.push(d.value),P.value=!1,t.notify({type:"negative",message:`${e("phoneNumberAlreadyInUse")}`,timeout:7e3,position:t.screen.lt.md?"top":"top-right"}))}),W&&j.length===1&&(T.value=!0)}else{const j=g[0][76];return await Oe(j)}return g}catch(g){console.log(g)}},Le=async()=>{try{return await f.deActivateAccount({phoneNumber:`+${m.value?m.value.dialCode:"1"}${d.value}`,userType:"Candidate"})}catch(o){console.log(o)}};return{firstName:le,lastName:re,email:Q,phoneNumber:d,password:z,passwordConfirmation:_e,isPwd:ke,codeConfirmation:H,verifyExistingPhoneNumber:ce,validPhone:P,validEmail:E,step:r,validPassword:B,loginType:$,firstNameMeta:be,lastNameMeta:ye,phoneNumberMeta:Ne,emailMeta:Me,passwordMeta:qe,passwordConfirmationMeta:Ie,codeConfirmationMeta:Ve,firstNameMessage:ge,lastNameMessage:he,passwordMessage:xe,phoneNumberMessage:we,emailMessage:Ce,passwordConfirmationMessage:Ae,errors:ve,meta:se,codeConfirmationMessage:Pe,updatePhoneMaxLength:De,createAccount:K,updateCountry:Se,phoneNumberPrompt:T,sendCode:Ee,codeExpiration:V,countDown:N,millisToMinutesAndSeconds:Re,codePrompt:F,closePhoneNumberPrompt:Te,codeRules:fe,onSubmit:o=>{r.value==="register"&&se.valid?K():o.preventDefault()}}}},na={key:0,class:"col-md-7 col-lg-8 col-lx-8"},ia={class:"col-xs-12 col-sm-12 col-md-5 col-lg-4 col-lx-4 row justify-center items-center"},da={class:"text-dark"},ma={class:"row q-col-gutter-xs"},ua={class:"row q-col-gutter-xs"},ca={class:"row q-col-gutter-xs"},pa={class:"row q-col-gutter-xs"},fa={class:"row justify-center"},va={class:"text-h6"},ga={class:"text-h6"};function ba(l,t,oe,e,P,E){const U=L("carousel"),m=L("phone-number-input"),B=L("router-link"),$=L("languageSelector");return b(),x(Ze,{class:"window-height window-width row"},{default:s(()=>[l.$q.screen.lt.md?q("",!0):(b(),me("div",na,[a(U)])),c("div",ia,[a(J,{class:"register-card",flat:""},{default:s(()=>[a(i,{style:{"padding-left":"30px","padding-right":"30px"}},{default:s(()=>[a(Be,{src:"https://cdn.jsdelivr.net/gh/EliteHCMS/assets@latest/public/logo.svg",fit:"scale-down",class:"register-logo full-width"})]),_:1}),a(i,{class:"text-center register-description"},{default:s(()=>[c("p",da,p(l.$t("register")),1)]),_:1}),a(i,null,{default:s(()=>[a(We,{class:"q-px-xs q-pt-xs",onSubmit:t[7]||(t[7]=Xe(()=>{},["prevent"])),onKeyup:ze(e.onSubmit,["enter"])},{default:s(()=>[c("div",ma,[a(_,{class:"col-xs-12 col-sm-6 q-pb-lg",clearable:"",outlined:"",modelValue:e.firstName,"onUpdate:modelValue":t[0]||(t[0]=r=>e.firstName=r),type:"text",autocomplete:"given-name",label:l.$t("firstName"),tabindex:"1",name:"firstName",error:!!(e.firstNameMessage&&e.firstNameMeta.validated),"error-message":e.firstNameMessage},{prepend:s(()=>[a(A,{name:"person"})]),_:1},8,["modelValue","label","error","error-message"]),a(_,{class:"col-xs-12 col-sm-6",clearable:"",outlined:"",modelValue:e.lastName,"onUpdate:modelValue":t[1]||(t[1]=r=>e.lastName=r),type:"text",autocomplete:"family-name",label:l.$t("lastName"),tabindex:"2",name:"lastName",error:!!(e.lastNameMessage&&e.lastNameMeta.validated),"error-message":e.lastNameMessage},{prepend:s(()=>[a(A,{name:"person_outline"})]),_:1},8,["modelValue","label","error","error-message"])]),c("div",ua,[a(m,{name:"phoneNumber",class:He(["col-xs-12 col-sm-12",{"q-pb-lg":e.phoneNumberMessage&&e.phoneNumberMeta.validated}]),outlined:"",modelValue:e.phoneNumber,"onUpdate:modelValue":t[2]||(t[2]=r=>e.phoneNumber=r),label:l.$t("phoneNumber"),tabindex:"3",onMaxLengthChanged:e.updatePhoneMaxLength,error:!!(e.phoneNumberMessage&&e.phoneNumberMeta.validated),"error-message":e.phoneNumberMessage,onCountryChanged:e.updateCountry},null,8,["class","modelValue","label","onMaxLengthChanged","error","error-message","onCountryChanged"])]),c("div",ca,[a(_,{class:"col-xs-12 col-sm-12 q-pb-lg",clearable:"",outlined:"",modelValue:e.email,"onUpdate:modelValue":t[3]||(t[3]=r=>e.email=r),type:"email",autocomplete:"email",label:l.$t("email"),tabindex:"4",name:"email",error:!!(e.emailMessage&&e.emailMeta.validated),"error-message":e.emailMessage},{prepend:s(()=>[a(A,{name:"email"})]),_:1},8,["modelValue","label","error","error-message"])]),c("div",pa,[e.step==="register"?(b(),x(_,{key:0,class:"col-xs-12 col-sm-6 q-pb-md",outlined:"",modelValue:e.password,"onUpdate:modelValue":t[5]||(t[5]=r=>e.password=r),type:e.isPwd?"password":"text",autocomplete:"current-password",label:l.$t("password"),tabindex:"5",error:!!(e.passwordMessage&&e.passwordMeta.validated),"error-message":e.passwordMessage},{append:s(()=>[a(A,{name:e.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:t[4]||(t[4]=r=>e.isPwd=!e.isPwd)},null,8,["name"])]),prepend:s(()=>[a(A,{name:"lock"})]),_:1},8,["modelValue","type","label","error","error-message"])):q("",!0),e.step==="register"?(b(),x(_,{key:1,class:"col-xs-12 col-sm-6 q-pb-md",outlined:"",modelValue:e.passwordConfirmation,"onUpdate:modelValue":t[6]||(t[6]=r=>e.passwordConfirmation=r),type:"password",autocomplete:"new-password",label:l.$t("confirmPassword"),tabindex:"6",error:!!(e.passwordConfirmationMessage&&e.passwordConfirmationMeta.validated),"error-message":e.passwordConfirmationMessage},{prepend:s(()=>[a(A,{name:"lock"})]),_:1},8,["modelValue","label","error","error-message"])):q("",!0)])]),_:1},8,["onKeyup"])]),_:1}),a(G,{class:"q-px-lg"},{default:s(()=>[e.step==="register"?(b(),x(I,{key:0,onClick:e.createAccount,unelevated:"",size:"lg",color:"primary",class:"full-width text-white",label:l.$t("createAccount"),tabindex:e.meta.valid?"7":"-1",disable:!e.meta.valid},null,8,["onClick","label","tabindex","disable"])):q("",!0)]),_:1}),a(i,{class:"text-center q-pa-sm"},{default:s(()=>[a(B,{to:"/login",class:"text-grey-6",tabindex:e.meta.valid?"8":"7"},{default:s(()=>[S(p(l.$t("alreadyHaveAnAccount")),1)]),_:1},8,["tabindex"])]),_:1}),a(i,{class:"q-pl-lg q-pa-sm"},{default:s(()=>[c("div",fa,[a($,{dense:"",borderless:""})])]),_:1})]),_:1}),a(Ke,{modelValue:e.phoneNumberPrompt,"onUpdate:modelValue":t[10]||(t[10]=r=>e.phoneNumberPrompt=r),persistent:""},{default:s(()=>[e.codePrompt?e.codePrompt?(b(),x(J,{key:1,style:{"min-width":"350px"}},{default:s(()=>[a(i,null,{default:s(()=>[c("div",ga,p(l.$t("mobilePhoneVerification")),1)]),_:1}),a(i,{class:"q-pt-none"},{default:s(()=>[S(p(l.$t("textMessageWithCodeSent")),1)]),_:1}),a(i,{class:"q-py-none q-p"},{default:s(()=>[a(_,{class:"col-xs-12 col-sm-6 q-pb-md",clearable:"",outlined:"",modelValue:e.codeConfirmation,"onUpdate:modelValue":t[8]||(t[8]=r=>e.codeConfirmation=r),type:"text",autocomplete:"one-time-code",inputmode:"numeric",pattern:"[0-9]*",label:l.$t("code"),tabindex:"1",maxlength:"6",minlength:"6",name:"codeConfirmation",error:!!e.codeRules,"error-message":"Code does not match!"},{append:s(()=>[S(p(e.millisToMinutesAndSeconds(e.countDown))+"\xA0 ",1)]),_:1},8,["modelValue","label","error"])]),_:1}),a(i,{class:"q-py-none row justify-center"},{default:s(()=>[e.countDown===0?(b(),me("a",{key:0,onClick:t[9]||(t[9]=(...r)=>e.sendCode&&e.sendCode(...r)),class:"text-grey-6",href:"javascript:void(0);"},p(l.$t("resendCode")),1)):q("",!0)]),_:1}),a(G,{align:"right",class:"text-primary"},{default:s(()=>[Y(a(I,{flat:"",label:l.$t("cancel"),onClick:e.closePhoneNumberPrompt},null,8,["label","onClick"]),[[ee]])]),_:1})]),_:1})):q("",!0):(b(),x(J,{key:0,style:{"min-width":"350px"}},{default:s(()=>[a(i,null,{default:s(()=>[c("div",va,p(l.$t("thisPhoneNumberAlreadyInUse")),1)]),_:1}),a(i,{class:"q-pt-none"},{default:s(()=>[S(p(l.$t("signInWithExistingAccount")),1)]),_:1}),a(i,{class:"q-pt-none"},{default:s(()=>[a(I,{to:"/login",color:"primary",label:l.$t("signIn")},null,8,["label"])]),_:1}),a(i,{class:"q-pt-none"},{default:s(()=>[S(p(l.$t("verifyPhoneNumberFirst")),1)]),_:1}),a(i,{class:"q-pt-none"},{default:s(()=>[a(I,{color:"primary",label:l.$t("sendCode"),onClick:e.sendCode},null,8,["label","onClick"])]),_:1}),a(G,{align:"right",class:"text-primary"},{default:s(()=>[Y(a(I,{flat:"",label:l.$t("cancel"),onClick:e.closePhoneNumberPrompt},null,8,["label","onClick"]),[[ee]]),Y(a(I,{flat:"",label:l.$t("ok"),onClick:e.closePhoneNumberPrompt},null,8,["label","onClick"]),[[ee]])]),_:1})]),_:1}))]),_:1},8,["modelValue"])])]),_:1})}var Ba=$e(ra,[["render",ba],["__scopeId","data-v-2df5dc1d"]]);export{Ba as default};
