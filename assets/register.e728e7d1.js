import{_ as Xe,c_ as Be,bT as Fe,bU as ze,c0 as Ze,bL as He,r as n,ac as de,c1 as Ke,c2 as h,d4 as We,c3 as Ge,c4 as y,b8 as W,d5 as ue,q as w,aT as j,g,ad as M,bd as l,h as me,al as a,ae as x,k as c,bO as i,c$ as Je,Z as p,bA as Ye,bz as ea,cy as q,bW as _,l as aa,bX as G,bV as A,ak as k,bQ as J,bf as Y,bY as ee,bZ as ta,bE as ae}from"./index.a71f5d5e.js";import{Q as oa}from"./QForm.6788df41.js";import{Q as la}from"./QPage.b5804b9e.js";import{p as sa}from"./VueTelInput.f8cd75ef.js";import{c as ra}from"./carousel.2dc4b3ca.js";import{api as na}from"./api.35ffa875.js";import"./use-panel.d4f51200.js";import"./use-fullscreen.f03c57f7.js";const ia={name:"Register",props:["phoneTemp","emailTemp"],components:{phoneNumberInput:sa,carousel:ra,languageSelector:Be},setup(s){const o=Fe(),O=ze(),{t:e}=Ze(),{currentUserType:S}=He(),I=n(!1),P=n(!1),D=n(10),u=n(null),$=n(!1),r=n("phoneNumber"),te=n("register"),E=n(!1),ce=n(!1),T=n([]),X=n(!1),oe=n(!1),v=n(null),V=n(null),N=n(0),pe=de(()=>{const t=new RegExp("^[0-9]{"+D.value+"}","g");return Ke({firstName:h().required().label(`${e("firstName")}`),lastName:h().required().label(`${e("lastName")}`),email:h().email(`${e("validEmailIsRequired")}`).required().label(`${e("email")}`),phoneNumber:h().matches(t,{excludeEmptyString:!0,message:`${e("validPhoneIsRequired")}`}).required().label(`${e("phoneNumber")}`),password:h().required().matches(/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d@$!%*#?&]{8,}$/,{excludeEmptyString:!0,message:`${e("passwordRules")}`}).nullable(),passwordConfirmation:h().oneOf([We("password"),null],`${e("passwordMustMatch")}`)})}),fe=de(()=>z.value===v.value);S==="Candidate"||O.push("/");const{errors:ge,meta:le}=Ge({validationSchema:pe,initialValues:{firstName:"",lastName:"",phoneNumber:"",email:"",password:"",passwordConfirmation:""}}),{value:se,errorMessage:ve,meta:be}=y("firstName"),{value:re,errorMessage:he,meta:ye}=y("lastName"),{value:d,errorMessage:we,setErrors:B,meta:Ne}=y("phoneNumber"),{value:U,errorMessage:Ce,setErrors:ne,meta:Me}=y("email"),{value:F,errorMessage:xe,meta:qe}=y("password"),{value:_e,errorMessage:Ae,meta:Ie}=y("passwordConfirmation"),{value:z,errorMessage:Pe,meta:Ve}=y("codeConfirmation",h().matches(/^[0-9]{6}/g,{excludeEmptyString:!0,message:`${e("validPhoneIsRequired")}`}).required().oneOf([v.value],`${e("codeMustMatch")}`)),ke=n(!0);s.phoneTemp&&(d.value=s.phoneTemp),s.emailTemp&&(U.value=s.emailTemp);const Se=t=>{D.value=t};W(d,t=>{T.value.includes(t)&&(B(`${e("phoneNumberAlreadyInUse")}`),T.value.push(d.value),I.value=!1,o.notify({type:"negative",message:`${e("phoneNumberAlreadyInUse")}`,timeout:7e3,position:o.screen.lt.md?"top":"top-right"}),E.value=!0)}),W(N,t=>{t===0&&(v.value=null,V.value=null),X.value=!0}),W(z,async t=>{Number(t)===v.value&&(oe.value=!0,await Oe(),await Z())});const De=t=>{u.value=t},Ee=async()=>{v.value=Math.floor(1e5+Math.random()*9e5),await na.createMessageQueue({to:d.value,messagingServiceSid:"MGd0e31773980318b7cdc5d2043117e27c",message:`${e("yourBrandSafwayVerificationCodeIs")} ${v.value}`,extRef:null,massText:!1}),V.value=ae().add(1,"minute"),Te()},Te=()=>{const t=setInterval(()=>{N.value=ae(V.value).valueOf()-ae().valueOf(),N.value<=0&&(N.value=0,clearInterval(t))},1e3)},Ue=()=>{E.value=!1,X.value=!1,v.value=null,V.value=null,N.value=0},Re=t=>{const f=Math.floor(t/6e4),m=(t%6e4/1e3).toFixed(0);return f+":"+(m<10?"0":"")+m},Qe=async t=>{const m=[{8:{value:`{'20'.CT.'${t[35]}'}AND{'22'.CT.'${t[37]}'}AND({'24'.CT.'${t[35]}'}AND{'24'.CT.'${t[37]}'})AND({'27'.EX.'${u.value?u.value.dialCode:"1"}${d.value}'}OR{'27'.EX.'${d.value}'})AND{'26'.EX.'${t[6]}'}AND{'509'.EX.'false'}`},7:{value:"Employees"},9:{value:12}}],{data:C}=await w.fetchFromHiringApp({fields:m});return C[0]?C[0][3]:null},Le=async t=>{const f=await w.isUserLoggedIn(),m=await Qe(t),C=new Date,b={3:{value:t[3]},26:{value:C}};if(m)b[80]={value:m};else return!1;try{f?await w.updateUserData({fields:b}):await w.upsertRecordsXML({to:"br4pxrbs6",fieldsToReturn:[76],data:[b],formatObject:76})}catch(H){console.log(H)}},je=async t=>{const f={password:F.value,userType:S,phoneNumber:`+${u.value?u.value.dialCode:"1"}${d.value}`};try{if(await w.login(f))return await Le(t),O.push({path:"/"})}catch(m){console.log(m)}},Z=async()=>{const t=U.value.match(/^([^@]*)@/)[1],f=await ue.genSalt(10),m=ue.hashSync(F.value,f),C=Math.floor(1e5+Math.random()*9e5),b=new Date,H=Object.assign({phoneNumber:d.value},u.value),$e=[{6:{value:U.value},7:{value:m},8:{value:`+${u.value?u.value.dialCode:"1"}${d.value}`},9:{value:JSON.stringify(H)},10:{value:"Active"},11:{value:7},21:{value:C},32:{value:"Candidate"},35:{value:se.value.trim()},37:{value:re.value.trim()},23:{value:0},24:{value:0},25:{value:b},26:{value:b},33:{value:t},50:{value:oe.value}}];try{const{data:R,metadata:ie}=await w.upsertRecordsXML({to:"br4pxrbs6",fieldsToReturn:[76],data:$e,formatObject:76});if(ie.lineErrors){const Q=ie.lineErrors[1];let K=!1;Q.forEach(L=>{L.includes('is not unique for unique formula field with ID "27"')&&(ne(`${e("emailAlreadyInUse")}`),P.value=!1,o.notify({type:"negative",message:`${e("emailAlreadyInUse")}`,timeout:7e3,position:o.screen.lt.md?"top":"top-right"})),L.includes('The field named "uniqueEmail" with field id 27 requires a unique value.')&&(ne(`${e("emailAlreadyInUse")}`),P.value=!1,o.notify({type:"negative",message:`${e("emailAlreadyInUse")}`,timeout:7e3,position:o.screen.lt.md?"top":"top-right"})),L.includes('is not unique for unique formula field with ID "28"')&&(K=!0,B(`${e("phoneNumberAlreadyInUse")}`),T.value.push(d.value),I.value=!1,o.notify({type:"negative",message:`${e("phoneNumberAlreadyInUse")}`,timeout:7e3,position:o.screen.lt.md?"top":"top-right"})),L.includes('The field named "uniquePhoneNumber" with field id 28 requires a unique value.')&&(K=!0,B(`${e("phoneNumberAlreadyInUse")}`),T.value.push(d.value),I.value=!1,o.notify({type:"negative",message:`${e("phoneNumberAlreadyInUse")}`,timeout:7e3,position:o.screen.lt.md?"top":"top-right"}))}),K&&Q.length===1&&(E.value=!0)}else{const Q=R[0][76];return await je(Q)}return R}catch(R){console.log(R)}},Oe=async()=>{try{return await w.deActivateAccount({phoneNumber:`+${u.value?u.value.dialCode:"1"}${d.value}`,userType:S})}catch(t){console.log(t)}};return{firstName:se,lastName:re,email:U,phoneNumber:d,password:F,passwordConfirmation:_e,isPwd:ke,codeConfirmation:z,verifyExistingPhoneNumber:ce,validPhone:I,validEmail:P,step:te,validPassword:$,loginType:r,firstNameMeta:be,lastNameMeta:ye,phoneNumberMeta:Ne,emailMeta:Me,passwordMeta:qe,passwordConfirmationMeta:Ie,codeConfirmationMeta:Ve,firstNameMessage:ve,lastNameMessage:he,passwordMessage:xe,phoneNumberMessage:we,emailMessage:Ce,passwordConfirmationMessage:Ae,errors:ge,meta:le,codeConfirmationMessage:Pe,updatePhoneMaxLength:Se,createAccount:Z,updateCountry:De,phoneNumberPrompt:E,sendCode:Ee,codeExpiration:V,countDown:N,millisToMinutesAndSeconds:Re,codePrompt:X,closePhoneNumberPrompt:Ue,codeRules:fe,onSubmit:t=>{te.value==="register"&&le.valid?Z():t.preventDefault()}}}},da={key:0,class:"col-md-7 col-lg-8 col-lx-8"},ua={class:"col-xs-12 col-sm-12 col-md-5 col-lg-4 col-lx-4 row justify-center items-center"},ma={class:"text-dark"},ca={class:"row q-col-gutter-xs"},pa={class:"row q-col-gutter-xs"},fa={class:"row q-col-gutter-xs"},ga={class:"row q-col-gutter-xs"},va={class:"row justify-center"},ba={class:"text-h6"},ha={class:"text-h6"};function ya(s,o,O,e,S,I){const P=j("carousel"),D=j("phone-number-input"),u=j("router-link"),$=j("languageSelector");return g(),M(la,{class:"window-height window-width row"},{default:l(()=>[s.$q.screen.lt.md?x("",!0):(g(),me("div",da,[a(P)])),c("div",ua,[a(J,{class:"register-card",flat:""},{default:l(()=>[a(i,{style:{"padding-left":"30px","padding-right":"30px"}},{default:l(()=>[a(Je,{src:"https://cdn.jsdelivr.net/gh/EliteHCMS/assets@latest/public/logo.svg",fit:"scale-down",class:"register-logo full-width"})]),_:1}),a(i,{class:"text-center register-description"},{default:l(()=>[c("p",ma,p(s.$t("register")),1)]),_:1}),a(i,null,{default:l(()=>[a(oa,{class:"q-px-xs q-pt-xs",onSubmit:o[7]||(o[7]=Ye(()=>{},["prevent"])),onKeyup:ea(e.onSubmit,["enter"])},{default:l(()=>[c("div",ca,[a(q,{class:"col-xs-12 col-sm-6 q-pb-lg",clearable:"",outlined:"",modelValue:e.firstName,"onUpdate:modelValue":o[0]||(o[0]=r=>e.firstName=r),type:"text",autocomplete:"given-name",label:s.$t("firstName"),tabindex:"1",name:"firstName",error:!!(e.firstNameMessage&&e.firstNameMeta.validated),"error-message":e.firstNameMessage},{prepend:l(()=>[a(_,{name:"person"})]),_:1},8,["modelValue","label","error","error-message"]),a(q,{class:"col-xs-12 col-sm-6",clearable:"",outlined:"",modelValue:e.lastName,"onUpdate:modelValue":o[1]||(o[1]=r=>e.lastName=r),type:"text",autocomplete:"family-name",label:s.$t("lastName"),tabindex:"2",name:"lastName",error:!!(e.lastNameMessage&&e.lastNameMeta.validated),"error-message":e.lastNameMessage},{prepend:l(()=>[a(_,{name:"person_outline"})]),_:1},8,["modelValue","label","error","error-message"])]),c("div",pa,[a(D,{name:"phoneNumber",class:aa(["col-xs-12 col-sm-12",{"q-pb-lg":e.phoneNumberMessage&&e.phoneNumberMeta.validated}]),outlined:"",modelValue:e.phoneNumber,"onUpdate:modelValue":o[2]||(o[2]=r=>e.phoneNumber=r),label:s.$t("phoneNumber"),tabindex:"3",onMaxLengthChanged:e.updatePhoneMaxLength,error:!!(e.phoneNumberMessage&&e.phoneNumberMeta.validated),"error-message":e.phoneNumberMessage,onCountryChanged:e.updateCountry},null,8,["class","modelValue","label","onMaxLengthChanged","error","error-message","onCountryChanged"])]),c("div",fa,[a(q,{class:"col-xs-12 col-sm-12 q-pb-lg",clearable:"",outlined:"",modelValue:e.email,"onUpdate:modelValue":o[3]||(o[3]=r=>e.email=r),type:"email",autocomplete:"email",label:s.$t("email"),tabindex:"4",name:"email",error:!!(e.emailMessage&&e.emailMeta.validated),"error-message":e.emailMessage},{prepend:l(()=>[a(_,{name:"email"})]),_:1},8,["modelValue","label","error","error-message"])]),c("div",ga,[e.step==="register"?(g(),M(q,{key:0,class:"col-xs-12 col-sm-6 q-pb-md",outlined:"",modelValue:e.password,"onUpdate:modelValue":o[5]||(o[5]=r=>e.password=r),type:e.isPwd?"password":"text",autocomplete:"current-password",label:s.$t("password"),tabindex:"5",error:!!(e.passwordMessage&&e.passwordMeta.validated),"error-message":e.passwordMessage},{append:l(()=>[a(_,{name:e.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:o[4]||(o[4]=r=>e.isPwd=!e.isPwd)},null,8,["name"])]),prepend:l(()=>[a(_,{name:"lock"})]),_:1},8,["modelValue","type","label","error","error-message"])):x("",!0),e.step==="register"?(g(),M(q,{key:1,class:"col-xs-12 col-sm-6 q-pb-md",outlined:"",modelValue:e.passwordConfirmation,"onUpdate:modelValue":o[6]||(o[6]=r=>e.passwordConfirmation=r),type:"password",autocomplete:"new-password",label:s.$t("confirmPassword"),tabindex:"6",error:!!(e.passwordConfirmationMessage&&e.passwordConfirmationMeta.validated),"error-message":e.passwordConfirmationMessage},{prepend:l(()=>[a(_,{name:"lock"})]),_:1},8,["modelValue","label","error","error-message"])):x("",!0)])]),_:1},8,["onKeyup"])]),_:1}),a(G,{class:"q-px-lg"},{default:l(()=>[e.step==="register"?(g(),M(A,{key:0,onClick:e.createAccount,unelevated:"",size:"lg",color:"primary",class:"full-width text-white",label:s.$t("createAccount"),tabindex:e.meta.valid?"7":"-1",disable:!e.meta.valid},null,8,["onClick","label","tabindex","disable"])):x("",!0)]),_:1}),a(i,{class:"text-center q-pa-sm"},{default:l(()=>[a(u,{to:"/login",class:"text-grey-6",tabindex:e.meta.valid?"8":"7"},{default:l(()=>[k(p(s.$t("alreadyHaveAnAccount")),1)]),_:1},8,["tabindex"])]),_:1}),a(i,{class:"q-pl-lg q-pa-sm"},{default:l(()=>[c("div",va,[a($,{dense:"",borderless:""})])]),_:1})]),_:1}),a(ta,{modelValue:e.phoneNumberPrompt,"onUpdate:modelValue":o[10]||(o[10]=r=>e.phoneNumberPrompt=r),persistent:""},{default:l(()=>[e.codePrompt?e.codePrompt?(g(),M(J,{key:1,style:{"min-width":"350px"}},{default:l(()=>[a(i,null,{default:l(()=>[c("div",ha,p(s.$t("mobilePhoneVerification")),1)]),_:1}),a(i,{class:"q-pt-none"},{default:l(()=>[k(p(s.$t("textMessageWithCodeSent")),1)]),_:1}),a(i,{class:"q-py-none q-p"},{default:l(()=>[a(q,{class:"col-xs-12 col-sm-6 q-pb-md",clearable:"",outlined:"",modelValue:e.codeConfirmation,"onUpdate:modelValue":o[8]||(o[8]=r=>e.codeConfirmation=r),type:"text",autocomplete:"one-time-code",inputmode:"numeric",pattern:"[0-9]*",label:s.$t("code"),tabindex:"1",maxlength:"6",minlength:"6",name:"codeConfirmation",error:!!e.codeRules,"error-message":"Code does not match!"},{append:l(()=>[k(p(e.millisToMinutesAndSeconds(e.countDown))+"\xA0 ",1)]),_:1},8,["modelValue","label","error"])]),_:1}),a(i,{class:"q-py-none row justify-center"},{default:l(()=>[e.countDown===0?(g(),me("a",{key:0,onClick:o[9]||(o[9]=(...r)=>e.sendCode&&e.sendCode(...r)),class:"text-grey-6",href:"javascript:void(0);"},p(s.$t("resendCode")),1)):x("",!0)]),_:1}),a(G,{align:"right",class:"text-primary"},{default:l(()=>[Y(a(A,{flat:"",label:s.$t("cancel"),onClick:e.closePhoneNumberPrompt},null,8,["label","onClick"]),[[ee]])]),_:1})]),_:1})):x("",!0):(g(),M(J,{key:0,style:{"min-width":"350px"}},{default:l(()=>[a(i,null,{default:l(()=>[c("div",ba,p(s.$t("thisPhoneNumberAlreadyInUse")),1)]),_:1}),a(i,{class:"q-pt-none"},{default:l(()=>[k(p(s.$t("signInWithExistingAccount")),1)]),_:1}),a(i,{class:"q-pt-none"},{default:l(()=>[a(A,{to:"/login",color:"primary",label:s.$t("signIn")},null,8,["label"])]),_:1}),a(i,{class:"q-pt-none"},{default:l(()=>[k(p(s.$t("verifyPhoneNumberFirst")),1)]),_:1}),a(i,{class:"q-pt-none"},{default:l(()=>[a(A,{color:"primary",label:s.$t("sendCode"),onClick:e.sendCode},null,8,["label","onClick"])]),_:1}),a(G,{align:"right",class:"text-primary"},{default:l(()=>[Y(a(A,{flat:"",label:s.$t("cancel"),onClick:e.closePhoneNumberPrompt},null,8,["label","onClick"]),[[ee]]),Y(a(A,{flat:"",label:s.$t("ok"),onClick:e.closePhoneNumberPrompt},null,8,["label","onClick"]),[[ee]])]),_:1})]),_:1}))]),_:1},8,["modelValue"])])]),_:1})}var Pa=Xe(ia,[["render",ya],["__scopeId","data-v-55be8434"]]);export{Pa as default};
