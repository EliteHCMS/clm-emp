var Z=Object.defineProperty;var Q=Object.getOwnPropertySymbols;var ee=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var V=(u,e,o)=>e in u?Z(u,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):u[e]=o,C=(u,e)=>{for(var o in e||(e={}))ee.call(e,o)&&V(u,o,e[o]);if(Q)for(var o of Q(e))te.call(e,o)&&V(u,o,e[o]);return u};import{Q as se}from"./QImg.89a86ab8.js";import{_ as ae,au as re,at as oe,r as R,c as le,w as ie,v as y,ae as w,af as l,x as ne,d as r,ai as q,z as m,b0 as b,ak as L,b5 as ue,b1 as j,b2 as n,b as O,ah as D,b3 as ce,aw as de,b4 as me}from"./index.33315d06.js";import{Q as pe}from"./QForm.b9a21415.js";import{Q as fe}from"./QPage.939b99b8.js";import{a as ve,e as ge,c as A,d as ye,b as be,u as S}from"./array.3939df7f.js";import{u as he}from"./i18n.49c5cd80.js";import{u as _e,e as we,c as qe,q as i}from"./quickbase.ce7a1496.js";import{_ as xe}from"./languageSelector.f15ced89.js";import{c as Ie}from"./carousel.138abe5b.js";import"./_commonjsHelpers.d497b07e.js";import"./dayjs.5943506b.js";import"./localForage.80cdaedd.js";import"./index.7dbe61ef.js";import"./QSelect.39e767e4.js";import"./QMenu.644a72a6.js";import"./position-engine.62252e5b.js";import"./selection.05e0127c.js";import"./use-quasar.f33f8e96.js";import"./use-panel.40fb95f7.js";import"./touch.6a3c5155.js";const Ue={key:0,class:"col-md-7 col-lg-8 col-lx-8"},ke={class:"col-xs-12 col-sm-12 col-md-5 col-lg-4 col-lx-4 row justify-center items-center"},Ce={class:"text-dark"},Re={class:"row"},De={class:"row"},Se={class:"text-grey-6"},$e={class:"row justify-center"},Me={__name:"verifyIdentity",setup(u){const e=_e(),{employeeData:o,socialRequired:$,updateEmployeeData:B,setEmployee:X}=we(),F=qe(),p=re(),f=oe(),{t:M}=he(),h=R(!1),x=R("confirm-identity"),T=le(()=>ve({userRID:ge().required(),ssn:A().required().matches(/^[0-9]{9}/g,{excludeEmptyString:!0,message:`${M("nineDigitsRequired")}`}).nullable(),ssnConfirmation:A().oneOf([ye("ssn"),null],`${M("socialSecurityNumberMustMatch")}`).required().nullable()})),{errors:Ne,meta:Y}=be({validationSchema:T,initialValues:{ssn:"",ssnConfirmation:""}}),{value:v}=S("userRID"),{value:c,errorMessage:N,meta:P}=S("ssn"),{value:g,errorMessage:E,meta:z}=S("ssnConfirmation"),_=R(!0);p.query.rid?(v.value=p.query.rid,c.value="",g.value="",f.replace({query:{}})):f.push("/"),ie(()=>p.query,()=>{p.query.rid&&(v.value=p.query.rid,c.value="",g.value="",f.replace({query:{}}))});const H=async()=>{const t=i.getOfficeLocation(),s=[{20:{value:e.getUser[35]},22:{value:e.getUser[37]},109:{value:c.value},25:{value:e.getUser[9]?e.getUser[9].phoneNumber:e.getUser[8].replace(/[^0-9]/g,"")},28:{value:e.getUser[50]?"Yes":"No"},26:{value:e.getUser[6]},34:{value:e.getUser[49]?"Yes":"No"},16:{value:t?t.rid:""}}],{data:a}=await i.upsertRecordsXML({to:"bp3gb7ng2",fieldsToReturn:[500],data:s,formatObject:500}),d=a[0][500];return e.userLoggedIn&&X(d,!0),d[3]},I=async t=>{const s=i.getOfficeLocation(),a=C({3:{value:t},20:{value:e.getUser[35]},22:{value:e.getUser[37]},109:{value:c.value},25:{value:e.getUser[9]?e.getUser[9].phoneNumber:e.getUser[8].replace(/[^0-9]/g,"")},28:{value:e.getUser[50]?"Yes":"No"},26:{value:e.getUser[6]},34:{value:e.getUser[49]?"Yes":"No"}},s&&{16:{value:s.rid}});return(await B({fields:a}))[3]},G=async t=>{const s=[{3:{value:e.getUser[86]},16:{value:t}}],{data:a}=await i.upsertRecordsXML({to:"br26nivmr",fieldsToReturn:[76],data:s,formatObject:76});return i.setCheckInData(a[0][76]),a[3]},J=async()=>{const s=[{8:{value:`{'188'.EX.'${c.value}'}AND{'509'.EX.'false'}`},7:{value:"Employees"},9:{value:12}}],{data:a}=await i.fetchFromHiringApp({fields:s});return a[0]?a[0][3]:null},K=async()=>{if(!v.value||v.value==="")return!1;h.value=!0;let t=await J();const s=new Date,a=[{3:{value:v.value},26:{value:s}}];$&&t?(await i.softDeleteEmployee(o[3]),await I(t)):$&&!t?t=await I(o[3]):t?await I(t):t||(t=await H()),F.checkedIn&&G(t),a[0][80]={value:t},a[0][85]={value:!1};try{const{data:d}=await i.upsertRecordsXML({to:"br4pxrbs6",fieldsToReturn:[76],data:a,formatObject:76}),U=d[0][76];if(e.userLoggedIn){const k=Object.assign({},U);delete k.access,delete k.permissions,i.setUserPermissions(U.permissions,!0),i.setUserAccess(U.access,!0),await i.setUserInfo(k,!0)}h.value=!1,f.push({path:"/",query:C({verify:!0},t&&{rid:t})})}catch(d){h.value=!1,console.log(d)}},W=()=>{e.logout().then(()=>{f.replace({name:"login"})})};return(t,s)=>(y(),w(fe,{class:"window-height window-width row"},{default:l(()=>[t.$q.screen.lt.md?q("",!0):(y(),ne("div",Ue,[r(Ie)])),m("div",ke,[r(me,{class:"auth-card",flat:""},{default:l(()=>[r(b,{style:{"padding-left":"30px","padding-right":"30px"}},{default:l(()=>[r(se,{src:"https://cdn.jsdelivr.net/gh/EliteHCMS/assets@latest/public/logo.svg",fit:"scale-down",class:"auth-logo full-width"})]),_:1}),r(b,{class:"text-center auth-description"},{default:l(()=>[m("p",Ce,L(t.$t("pleaseVerifyInfoToCompleteRegistration")),1)]),_:1}),r(b,null,{default:l(()=>[r(pe,{class:"q-px-sm q-pt-sm",onSubmit:s[3]||(s[3]=ue(()=>{},["prevent"]))},{default:l(()=>[m("div",Re,[x.value==="confirm-identity"?(y(),w(j,{key:0,class:"col-xs-12",outlined:"",mask:"#########",modelValue:n(c),"onUpdate:modelValue":s[0]||(s[0]=a=>O(c)?c.value=a:null),maxlength:"9",minlength:"9",type:"password",label:t.$t("socialSecurityNumber"),tabindex:"1",error:!!(n(N)&&n(P).validated),"error-message":n(N)},{prepend:l(()=>[r(D,{name:"lock"})]),_:1},8,["modelValue","label","error","error-message"])):q("",!0)]),m("div",De,[x.value==="confirm-identity"?(y(),w(j,{key:0,class:"col-xs-12",outlined:"",mask:"#########",modelValue:n(g),"onUpdate:modelValue":s[2]||(s[2]=a=>O(g)?g.value=a:null),maxlength:"9",minlength:"9",type:_.value?"password":"text",label:t.$t("confirmSSN"),tabindex:"2",error:!!(n(E)&&n(z).validated),"error-message":n(E)},{prepend:l(()=>[r(D,{name:"lock"})]),append:l(()=>[r(D,{name:_.value?"visibility_off":"visibility",class:"cursor-pointer",onClick:s[1]||(s[1]=a=>_.value=!_.value)},null,8,["name"])]),_:1},8,["modelValue","type","label","error","error-message"])):q("",!0)])]),_:1})]),_:1}),r(ce,{class:"q-px-lg"},{default:l(()=>[x.value==="confirm-identity"?(y(),w(de,{key:0,loading:h.value,disable:!n(Y).valid,unelevated:"",size:"lg",color:"primary",class:"full-width text-white",label:t.$t("confirm"),tabindex:"3",onClick:K},null,8,["loading","disable","label"])):q("",!0)]),_:1}),r(b,{class:"text-center q-pa-sm"},{default:l(()=>[m("p",Se,[m("a",{onClick:W,class:"text-grey-6",href:"javascript:void(0);",tabindex:"4"},L(t.$t("logout")),1)])]),_:1}),r(b,{class:"q-pl-lg q-pa-sm"},{default:l(()=>[m("div",$e,[r(xe,{dense:"",borderless:""})])]),_:1})]),_:1})])]),_:1}))}};var tt=ae(Me,[["__scopeId","data-v-f511c8d0"]]);export{tt as default};
