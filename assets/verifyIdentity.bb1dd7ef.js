var W=Object.defineProperty;var V=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var j=(u,e,o)=>e in u?W(u,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):u[e]=o,C=(u,e)=>{for(var o in e||(e={}))Z.call(e,o)&&j(u,o,e[o]);if(V)for(var o of V(e))ee.call(e,o)&&j(u,o,e[o]);return u};import{Q as te}from"./QImg.72888a4a.js";import{_ as se,at as ae,as as re,r as D,c as oe,w as le,u as y,ad as w,ae as l,v as ie,d as r,ah as q,y as d,a_ as _,aj as L,b3 as ne,a$ as O,b0 as n,b as A,ag as R,b1 as ue,au as ce,b2 as de}from"./index.3fc9d1e3.js";import{Q as me}from"./QForm.267ea296.js";import{Q as pe}from"./QPage.a1af35df.js";import{a as fe,e as ve,c as B,d as ge,b as ye,u as S}from"./array.c1624bb5.js";import{u as _e}from"./i18n.1e90a26c.js";import{u as be,c as he,b as we,q as i}from"./quickbase.f91466b9.js";import{_ as qe}from"./languageSelector.08a6b256.js";import{c as Ue}from"./carousel.1d7fdcf2.js";import"./_commonjsHelpers.d497b07e.js";import"./dayjs.4a0d4cc5.js";import"./localForage.4ff4be7a.js";import"./index.7dbe61ef.js";import"./QSelect.912eaa4a.js";import"./QMenu.34b2ab10.js";import"./position-engine.d724cd27.js";import"./selection.f57f9a64.js";import"./use-quasar.8e3e7d63.js";import"./use-panel.91db2420.js";import"./touch.6a3c5155.js";const xe={key:0,class:"col-md-7 col-lg-8 col-lx-8"},Ie={class:"col-xs-12 col-sm-12 col-md-5 col-lg-4 col-lx-4 row justify-center items-center"},ke={class:"text-dark"},Ce={class:"row"},De={class:"row"},Re={class:"text-grey-6"},Se={class:"row justify-center"},$e={__name:"verifyIdentity",setup(u){const e=be(),{employeeData:o,socialRequired:$,updateEmployeeData:N}=he(),F=we(),m=ae(),p=re(),{t:M}=_e(),b=D(!1),U=D("confirm-identity"),X=oe(()=>fe({userRID:ve().required(),ssn:B().required().matches(/^[0-9]{9}/g,{excludeEmptyString:!0,message:`${M("nineDigitsRequired")}`}).nullable(),ssnConfirmation:B().oneOf([ge("ssn"),null],`${M("socialSecurityNumberMustMatch")}`).required().nullable()})),{errors:Ne,meta:Y}=ye({validationSchema:X,initialValues:{ssn:"",ssnConfirmation:""}}),{value:f}=S("userRID"),{value:c,errorMessage:Q,meta:P}=S("ssn"),{value:v,errorMessage:E,meta:T}=S("ssnConfirmation"),h=D(!0);m.query.rid?(f.value=m.query.rid,c.value="",v.value="",p.replace({query:{}})):p.push("/"),le(()=>m.query,()=>{m.query.rid&&(f.value=m.query.rid,c.value="",v.value="",p.replace({query:{}}))});const H=async()=>{const t=i.getOfficeLocation(),s={20:{value:e.getUser[35]},22:{value:e.getUser[37]},109:{value:c.value},25:{value:e.getUser[9]?e.getUser[9].phoneNumber:e.getUser[8].replace(/[^0-9]/g,"")},28:{value:e.getUser[50]?"Yes":"No"},26:{value:e.getUser[6]},34:{value:e.getUser[49]?"Yes":"No"},16:{value:t?t.rid:""}};return(await N({fields:s}))[3]},x=async t=>{const s=i.getOfficeLocation(),a=C({3:{value:t},20:{value:e.getUser[35]},22:{value:e.getUser[37]},109:{value:c.value},25:{value:e.getUser[9]?e.getUser[9].phoneNumber:e.getUser[8].replace(/[^0-9]/g,"")},28:{value:e.getUser[50]?"Yes":"No"},26:{value:e.getUser[6]},34:{value:e.getUser[49]?"Yes":"No"}},s&&{16:{value:s.rid}});return(await N({fields:a}))[3]},z=async t=>{const s=[{3:{value:e.getUser[86]},16:{value:t}}],{data:a}=await i.upsertRecordsXML({to:"br26nivmr",fieldsToReturn:[76],data:s,formatObject:76});return i.setCheckInData(a[0][76]),a[3]},G=async()=>{const s=[{8:{value:`{'188'.EX.'${c.value}'}AND{'509'.EX.'false'}`},7:{value:"Employees"},9:{value:12}}],{data:a}=await i.fetchFromHiringApp({fields:s});return a[0]?a[0][3]:null},J=async()=>{if(!f.value||f.value==="")return!1;b.value=!0;let t=await G();const s=new Date,a=[{3:{value:f.value},26:{value:s}}];$&&t?(await i.softDeleteEmployee(o[3]),await x(t)):$&&!t?t=await x(o[3]):t?await x(t):t||(t=await H()),F.checkedIn&&z(t),a[0][80]={value:t},a[0][85]={value:!1};try{const{data:g}=await i.upsertRecordsXML({to:"br4pxrbs6",fieldsToReturn:[76],data:a,formatObject:76}),I=g[0][76];if(e.userLoggedIn){const k=Object.assign({},I);delete k.access,delete k.permissions,i.setUserPermissions(I.permissions,!0),i.setUserAccess(I.access,!0),await i.setUserInfo(k,!0)}b.value=!1,p.push({path:"/",query:C({verify:!0},t&&{rid:t})})}catch(g){b.value=!1,console.log(g)}},K=()=>{e.logout().then(()=>{p.replace({name:"login"})})};return(t,s)=>(y(),w(pe,{class:"window-height window-width row"},{default:l(()=>[t.$q.screen.lt.md?q("",!0):(y(),ie("div",xe,[r(Ue)])),d("div",Ie,[r(de,{class:"auth-card",flat:""},{default:l(()=>[r(_,{style:{"padding-left":"30px","padding-right":"30px"}},{default:l(()=>[r(te,{src:"https://cdn.jsdelivr.net/gh/EliteHCMS/assets@latest/public/logo.svg",fit:"scale-down",class:"auth-logo full-width"})]),_:1}),r(_,{class:"text-center auth-description"},{default:l(()=>[d("p",ke,L(t.$t("pleaseVerifyInfoToCompleteRegistration")),1)]),_:1}),r(_,null,{default:l(()=>[r(me,{class:"q-px-sm q-pt-sm",onSubmit:s[3]||(s[3]=ne(()=>{},["prevent"]))},{default:l(()=>[d("div",Ce,[U.value==="confirm-identity"?(y(),w(O,{key:0,class:"col-xs-12",outlined:"",mask:"#########",modelValue:n(c),"onUpdate:modelValue":s[0]||(s[0]=a=>A(c)?c.value=a:null),maxlength:"9",minlength:"9",type:"password",label:t.$t("socialSecurityNumber"),tabindex:"1",error:!!(n(Q)&&n(P).validated),"error-message":n(Q)},{prepend:l(()=>[r(R,{name:"lock"})]),_:1},8,["modelValue","label","error","error-message"])):q("",!0)]),d("div",De,[U.value==="confirm-identity"?(y(),w(O,{key:0,class:"col-xs-12",outlined:"",mask:"#########",modelValue:n(v),"onUpdate:modelValue":s[2]||(s[2]=a=>A(v)?v.value=a:null),maxlength:"9",minlength:"9",type:h.value?"password":"text",label:t.$t("confirmSSN"),tabindex:"2",error:!!(n(E)&&n(T).validated),"error-message":n(E)},{prepend:l(()=>[r(R,{name:"lock"})]),append:l(()=>[r(R,{name:h.value?"visibility_off":"visibility",class:"cursor-pointer",onClick:s[1]||(s[1]=a=>h.value=!h.value)},null,8,["name"])]),_:1},8,["modelValue","type","label","error","error-message"])):q("",!0)])]),_:1})]),_:1}),r(ue,{class:"q-px-lg"},{default:l(()=>[U.value==="confirm-identity"?(y(),w(ce,{key:0,loading:b.value,disable:!n(Y).valid,unelevated:"",size:"lg",color:"primary",class:"full-width text-white",label:t.$t("confirm"),tabindex:"3",onClick:J},null,8,["loading","disable","label"])):q("",!0)]),_:1}),r(_,{class:"text-center q-pa-sm"},{default:l(()=>[d("p",Re,[d("a",{onClick:K,class:"text-grey-6",href:"javascript:void(0);",tabindex:"4"},L(t.$t("logout")),1)])]),_:1}),r(_,{class:"q-pl-lg q-pa-sm"},{default:l(()=>[d("div",Se,[r(qe,{dense:"",borderless:""})])]),_:1})]),_:1})])]),_:1}))}};var et=se($e,[["__scopeId","data-v-3e211c8f"]]);export{et as default};
