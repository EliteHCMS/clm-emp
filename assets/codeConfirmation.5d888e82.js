import{Q as G}from"./QImg.600f90ee.js";import{_ as H,au as Y,at as J,r as g,c as K,w as j,v as i,ae as S,af as f,b2 as Q,x as v,d as y,ai as l,z as x,b0 as C,ak as R,aj as E,b5 as W,b1 as Z,b as ee,aw as te,b4 as se,bG as ae,bH as oe}from"./index.603cf1ae.js";import{Q as re}from"./QForm.0063d907.js";import{Q as ne}from"./QPage.ac09746b.js";import{u as ie}from"./use-quasar.fe037348.js";import{u as le,c as ue}from"./array.773da7ec.js";import{u as ce,q as o}from"./quickbase.6d6dff0f.js";import{c as de}from"./carousel.3b6871c9.js";import{api as me}from"./api.b69025eb.js";import{dayjs as q}from"./dayjs.a098b653.js";import"./_commonjsHelpers.d497b07e.js";import"./localForage.4a417ded.js";import"./index.7dbe61ef.js";import"./i18n.f0e70f8b.js";import"./use-panel.95a75ca2.js";import"./touch.6a3c5155.js";import"./selection.c665e319.js";const O=I=>(ae("data-v-02cf4737"),I=I(),oe(),I),pe={key:0,class:"col-md-7 col-lg-8 col-lx-8"},fe={class:"col-xs-12 col-sm-12 col-md-5 col-lg-4 col-lx-4 row justify-center items-center"},ve={key:0,class:"text-dark"},ge={key:1,class:"text-dark"},ye={key:2,class:"text-dark"},he={key:3,class:"text-dark"},be=O(()=>x("br",null,null,-1)),_e={key:4,class:"text-dark"},xe=O(()=>x("br",null,null,-1)),we={key:2,class:"text-grey-6 text-right"},ke={key:3,class:"text-grey-6 text-right"},Ce={__name:"codeConfirmation",setup(I){const h=ie(),V=ce(),d=Y(),b=J(),D=g(""),r=g("phone number"),u=g("code-confirmation"),p=g(Math.floor(1e5+Math.random()*9e5)),w=g(null),U=g(!1),k=g(0),m=g(null),{value:_}=le("codeConfirmation",ue().matches(/^[0-9]{6}/g,{excludeEmptyString:!0,message:"Code Not Valid!"}).required().oneOf([p.value],"Code Not Valid!")),L=K(()=>_.value===p.value),T=t=>{const e=Math.floor(t/6e4),a=(t%6e4/1e3).toFixed(0);return e+":"+(a<10?"0":"")+a};j(r,t=>{p.value=null,_.value=null,U.value=!1,p.value=null,w.value=null,u.value="code-confirmation"}),j(k,t=>{t===0?(U.value=!0,p.value=null,w.value=null):U.value=!1}),j(_,async t=>{Number(t)===p.value&&(h.notify({position:"top-right",type:"positive",message:"Code Verified!"}),r.value==="phone number"?B():r.value==="email"&&$())});const M=async()=>{p.value=Math.floor(1e5+Math.random()*9e5),_.value=null,w.value=q().add(5,"minute").toISOString(),r.value==="phone number"?(await me.createMessageQueue({to:D.value,messagingServiceSid:"MGd0e31773980318b7cdc5d2043117e27c",message:`Your Brandsafway Verification Code is: ${p.value}`,extRef:null,massText:!1}),h.notify({position:"top-right",type:"info",message:"Text message sent!"}),w.value=q().add(1,"minute")):r.value==="email"&&(A(),h.notify({position:"top-right",type:"info",message:"Email sent!"}),w.value=q().add(2,"minute")),P(),u.value="code-sent"},P=()=>{const t=setInterval(()=>{k.value=q(w.value).valueOf()-q().valueOf(),k.value<=0&&(k.value=0,clearInterval(t))},1e3)},A=async()=>{if(!m.value||m.value==="")return!1;const t=await o.isUserLoggedIn(),e=new Date,a=[{3:{value:m.value},26:{value:e},87:{value:e},88:{value:p.value},47:{value:!0}}];try{const{data:n}=await o.upsertRecordsXML({to:"br4pxrbs6",fieldsToReturn:[76],data:a,formatObject:76}),s=n[0][76];if(t){const c=Object.assign({},s);delete c.access,delete c.permissions,o.setUserPermissions(s.permissions,!0),o.setUserAccess(s.access,!0),await o.setUserInfo(c,!0)}}catch(n){h.notify({position:"top-right",type:"negative",message:n.message||"Error updating Verification!"})}},B=async()=>{if(!m.value||m.value==="")return!1;const t=await o.isUserLoggedIn(),e=new Date,a=[{3:{value:m.value},26:{value:e},50:{value:!0}}];try{const{data:n}=await o.upsertRecordsXML({to:"br4pxrbs6",fieldsToReturn:[76],data:a,formatObject:76}),s=n[0][76];if(t){const c=Object.assign({},s);delete c.access,delete c.permissions,o.setUserPermissions(s.permissions,!0),o.setUserAccess(s.access,!0),await o.setUserInfo(c,!0),b.push({path:"/",query:{code:!0}})}else b.push({name:"password-update",query:{rid:s[3],ac:!0}})}catch(n){h.notify({position:"top-right",type:"negative",message:n.message||"Error updating Verification!"})}},$=async()=>{if(!m.value||m.value==="")return!1;const t=await o.isUserLoggedIn(),e=new Date,a=[{3:{value:m.value},26:{value:e},49:{value:!0}}];try{const{data:n}=await o.upsertRecordsXML({to:"br4pxrbs6",fieldsToReturn:[76],data:a,formatObject:76}),s=n[0][76];if(t){const c=Object.assign({},s);delete c.access,delete c.permissions,o.setUserPermissions(s.permissions,!0),o.setUserAccess(s.access,!0),await o.setUserInfo(c,!0),b.push({path:"/",query:{code:!0}})}else b.push({name:"password-update",query:{rid:s[3],ac:!0}})}catch(n){h.notify({position:"top-right",type:"negative",message:n.message||"Error updating Verification!"})}},F=()=>{V.logout().then(()=>{b.replace({name:"login"})})},X=()=>D.value.replace(/(\d{3})(\d{3})(\d{4})/,"******$3"),z=()=>(V.user?V.user[34]:"").replace(/(.{2})(.*)(?=@)/,function(e,a,n){for(let s=0;s<n.length;s++)a+="*";return a});j(()=>d.query,()=>{N(!1)});const N=async t=>{if(d.query.p&&d.query.rid){u.value="code-confirmation",D.value=d.query.p,m.value=d.query.rid,d.query.p=null,d.query.rid=null;const e=Object.assign({},d.query);delete e.p,delete e.rid,(d.query.send==="true"||d.query.send===!0)&&M(),delete e.send,b.replace({query:e})}else t&&b.push("/login")};return N(!0),(t,e)=>(i(),S(ne,{class:"window-height window-width row"},{default:f(()=>[Q(h).screen.lt.md?l("",!0):(i(),v("div",pe,[y(de)])),x("div",fe,[y(se,{class:"auth-card",flat:""},{default:f(()=>[y(C,{style:{"padding-left":"30px","padding-right":"30px"}},{default:f(()=>[y(G,{src:"https://cdn.jsdelivr.net/gh/EliteHCMS/assets@latest/public/logo.svg",fit:"scale-down",class:"auth-logo full-width"})]),_:1}),y(C,{class:"text-center auth-description"},{default:f(()=>[u.value==="code-sent"&&r.value==="phone number"?(i(),v("p",ve,"A text message with a verification code has been sent to your phone.")):l("",!0),u.value==="code-sent"&&r.value==="email"?(i(),v("p",ge,"A verification code has been sent to your email. ")):l("",!0),u.value==="code-confirmation"?(i(),v("p",ye,"Your "+R(r.value)+" needs to be verified click the button below to verify.",1)):l("",!0),u.value==="code-confirmation"&&r.value==="phone number"?(i(),v("p",he,[be,E(R(X()),1)])):l("",!0),u.value==="code-confirmation"&&r.value==="email"?(i(),v("p",_e,[xe,E(R(z()),1)])):l("",!0)]),_:1}),y(C,null,{default:f(()=>[y(re,{class:"q-px-sm q-pt-sm",onSubmit:e[3]||(e[3]=W(()=>{},["prevent"]))},{default:f(()=>[u.value==="code-sent"?(i(),S(Z,{key:0,class:"col-xs-12 col-sm-6 q-pb-md",clearable:"",outlined:"",disable:U.value,modelValue:Q(_),"onUpdate:modelValue":e[0]||(e[0]=a=>ee(_)?_.value=a:null),type:"text",autocomplete:"one-time-code",inputmode:"numeric",pattern:"[0-9]*",label:"Code",tabindex:"1",maxlength:"6",minlength:"6",name:"codeConfirmation",error:!!Q(L),"error-message":"Code does not match!"},{append:f(()=>[E(R(T(k.value))+"\xA0 ",1)]),_:1},8,["disable","modelValue","error"])):l("",!0),u.value==="code-confirmation"?(i(),S(te,{key:1,unelevated:"",size:"lg",color:"primary",class:"full-width text-white",label:"Send Code",tabindex:"1",onClick:M})):l("",!0),r.value==="phone number"?(i(),v("p",we,[x("a",{href:"javascript:void(0);",onClick:e[1]||(e[1]=a=>r.value="email")},"Use Email")])):l("",!0),r.value==="email"?(i(),v("p",ke,[x("a",{href:"javascript:void(0);",onClick:e[2]||(e[2]=a=>r.value="phone number")},"Use Phone Number")])):l("",!0),u.value==="code-sent"?(i(),S(C,{key:4,class:"q-py-none row justify-center"},{default:f(()=>[k.value===0?(i(),v("a",{key:0,onClick:M,class:"text-grey-6",href:"javascript:void(0);",tabindex:"2"},"Resend Code")):l("",!0)]),_:1})):l("",!0)]),_:1})]),_:1}),y(C,{class:"text-center q-pa-sm"},{default:f(()=>[x("p",{class:"text-grey-6"},[x("a",{onClick:F,class:"text-grey-6",href:"javascript:void(0);",tabindex:"3"},"Logout")])]),_:1})]),_:1})])]),_:1}))}};var Be=H(Ce,[["__scopeId","data-v-02cf4737"]]);export{Be as default};
