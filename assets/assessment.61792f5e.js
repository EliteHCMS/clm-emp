import{a$ as h,I as l,J as u,aE as c,q as r,L as d}from"./index.8dce50c2.js";const f=25,D=h("assessment",{state:()=>({step:0,loading:!0,tools:[],testData:{allQuestions:[],selectedQuestions:[],completedQuestions:[],nextQuestions:null,testStatus:"In Progress",currentScope:0,loadIteration:0,qb:{testRecord:{3:{field:"Record ID#",value:24712},6:{field:"Related Kiosk Profile"},13:{field:"Related Hiring Center"},15:{field:"Related Employee"},17:{field:"Related Craft"},23:{field:"Related Available Language"},34:{field:"Test Completion Timestamp"},37:{field:"Test Status"},testQuestions:[{6:{field:"Related Test"},7:{field:"Related All Test Question"},11:{field:"Status"},questionResponse:[{6:{field:"Related Test Question"},8:{field:"Related Question Alternative"}}]}]}}},testId:null,qb:null,questions:[],answers:[],toolListId:null}),getters:{questionsLoaded(){return this.testData.allQuestions.length>0},nextQuestions(){return this.testData.nextQuestions?this.testData.nextQuestions:null},completedOnIteration(){return this.testData.completedQuestions.filter(t=>t.iteration===this.testData.loadIteration)},algo(){const t=this.testData.completedQuestions.filter(s=>s.selection[14]===1&&s.iteration===this.testData.loadIteration);return t!==void 0?t:[]},ratio(){return isNaN(this.algo.length/this.completedOnIteration.length)?0:(this.algo.length/this.completedOnIteration.length).toFixed(2)},nextScope(){return this.completedOnIteration.length>0?this.ratio>.6?this.testData.currentScope<6?this.testData.currentScope+1:this.testData.currentScope:this.ratio===.6?this.testData.currentScope:this.testData.currentScope>2?this.testData.currentScope-1:this.testData.currentScope:this.testData.currentScope},nextIteration(){return this.testData.loadIteration+1},timeToStop(){const t=this.testData.completedQuestions.filter(e=>e[23]>this.testData.currentScope).length,s=this.testData.completedQuestions.filter(e=>e[23]<this.testData.currentScope).length;return t>0&&s>0&&this.testData.completedQuestions.length>=f},toolChecklistData(){const{hiringCenter:t,testForCraft:s}=l(),{employeeData:e}=u(),a={6:{value:this.testId?this.testId:0},11:{value:t[3]?t[3].value:0},15:{value:e[3]?e[3]:0},20:{value:s[15]?s[15]:0},22:{value:s[16]?s[16]:0}};return{to:"bp3gcpk2w",data:[a],fieldsToReturn:[3]}},toolsData(){const t=[];return this.tools.length>0&&this.tools.forEach(s=>{const e={6:{value:this.toolListId?this.toolListId:0},7:{value:s.value}};t.push(e)}),{to:"bp928wac2",data:t,fieldsToReturn:[3]}}},actions:{async startAssessment(){const{profile:t}=c(),{hiringCenter:s,testForCraft:e}=l(),{employeeData:a,updateEmployeeData:o}=u(),n={13:{value:s[3].value},15:{value:a[3]},17:{value:e[15]},23:{value:e[16]},51:{value:e[3]}};t[3]!==void 0&&Object.assign(n,{6:{value:t[3].value}});const{data:i}=await r.upsertRecordsXML({to:"bp3gckirf",data:[n],fieldsToReturn:[3]});if(i[0])return this.testId=i[0][3],o({fields:{122:{value:8}}}),i[0];throw"Something went wrong"},async finishAssessment(){const{metadata:t}=await r.upsertRecordsXML({to:"bp3gckirf",data:[{3:{value:this.testId},34:{value:new Date},37:{value:"Complete"}}],mergeFieldId:3,fieldsToReturn:[3]});if(t.updatedRecordIds[0]){const{data:s}=await r.upsertRecordsXML({to:"bp9np6ckn",data:this.questions,fieldsToReturn:[3,7]});if(!s.length>0)throw"Cannot save questions";{const e=[];s.forEach(o=>{const n=this.answers.findIndex(i=>i.link===o[7]);if(n>-1){const i={6:{value:o[3]},8:{value:this.answers[n][8]}};e.push(i)}});const{metadata:a}=await r.upsertRecordsXML({to:"bp9np9vk7",data:e,fieldsToReturn:[3]});if(!a.createdRecordIds.length===this.answers.length)throw"Something went wrong";return{success:!0}}}else throw"Cannot finish assessment"},async startToolChecklist(){const{data:t}=await r.upsertRecordsXML(this.toolChecklistData);if(t[0])return this.toolListId=t[0][3],t[0];throw"Cannot start checklist"},async finishToolChecklist(){const{metadata:t}=await r.upsertRecordsXML({to:"bp3gcpk2w",data:[{3:{value:this.toolListId},18:{value:new Date},17:{value:"Complete"}}],mergeFieldId:3,fieldsToReturn:[3]});if(t.updatedRecordIds[0]){const{data:s}=await r.upsertRecordsXML(this.toolsData);if(s.length>0)return!0;throw"Cannot save tools"}else throw"Cannot finish tool checklist"},async submitToQB(){const{profile:t}=c(),{hiringCenter:s,testForCraft:e}=l(),{devEmployee:a}=u();this.testData.qb.testRecord[6].value=t[3].value,this.testData.qb.testRecord[13].value=s[3].value,this.testData.qb.testRecord[15].value=a[3],this.testData.qb.testRecord[17].value=e[15],this.testData.qb.testRecord[23].value=e[16],this.testData.qb.testRecord[34].value=Date.now(),this.testData.qb.testRecord[37].value="Complete";const o=[];return this.testData.completedQuestions.forEach(n=>{const i={6:{value:this.testData.qb.testRecord[3].value},7:{value:n[8]},11:{value:"Complete"},questionResponse:[{6:{value:0},8:{value:n.selection[3]}}]};o.push(i)}),this.testData.qb.testRecord.testQuestions=o,this.testData.qb.testRecord},async updateAssessment(t){return this.step=t.next,t.type==="tools"&&(this.tools=t.values),!0},updateStep(t){this.step=t},dataLoaded(){this.loading=!1},async getAllQuestions(){const{testForCraft:t}=l();if(this.questionsLoaded)return!0;if(t)try{const{data:s}=await r.fetchFromStructureApp({fields:[{6:{value:"bqamed7sr"},7:{value:"Table Query"},8:{value:`{'6'.EX.'${t[9]}'}`},9:{value:1},14:{value:17}}]});if(s)return s.forEach(async e=>{e[20]&&(e.hasImage=!0,e.imageData={src:e[22],alt:e[21]}),e[19].forEach(a=>{a.value=a[3],a.label=a[6]})}),this.testData.allQuestions=s,!0;throw"Something went wrong"}catch(s){console.log(s);const{data:e}=await r.doQuery({from:"bqamed7sr",where:`{'6'.EX.'${t[9]}'}`,select:[3,6,8,9,10,11,12,13,14,18,19,20,21,22,23,24],sortBy:[{fieldId:11,order:"ASC"}]});if(e)return e.forEach(async a=>{a[20]==="Yes"&&(a.hasImage=!0,a.imageData={src:a[22],alt:a[21]}),a[19]=await d.converter(a[19]),a[24]=await d.converter(a[24]),a[19].forEach(o=>{o.value=o[3],o.label=o[6]})}),this.testData.allQuestions=e,!0;throw"Something went wrong"}else throw"No test for craft"},async loadQuestionGroup(t,s){if(t!==void 0){const e=this.testData.allQuestions.filter(a=>a[23]===t);if(e.length>0)return e.length>5&&(e.length=5),e.forEach(a=>{a.response=null;const o=this.testData.allQuestions.findIndex(n=>n[3]===a[3]);o>-1&&this.testData.allQuestions.splice(o,1)}),this.testData.nextQuestions=e,this.testData.currentScope=t,this.testData.loadIteration=s,e;throw"There are no questions"}},async completeQuestion(t){const s=t.response,e=t[19].find(n=>n.value===s);if(e!==void 0)t.selection=e;else throw"No selection";t.iteration=this.testData.loadIteration,t.storedData={};const a={6:{value:this.testId},7:{value:t[8]},11:{value:"Complete"}};this.questions.push(a);const o={6:null,8:t.selection[3],link:t[8]};return this.answers.push(o),this.testData.completedQuestions.push(t),this.testData.nextQuestions=this.testData.nextQuestions.filter(n=>n[3]!==t[3]),{data:{nextQuestions:this.timeToStop?[]:this.testData.nextQuestions,scope:this.nextScope,iteration:this.nextIteration}}}}});export{D as u};
