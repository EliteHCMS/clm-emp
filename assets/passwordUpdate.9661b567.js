import{Q as E}from"./QImg.0790ec49.js";import{_ as F,au as O,at as H,r as k,c as T,ar as Z,v as l,ae as w,af as s,b2 as t,x as G,d as e,ai as f,z as r,b0 as _,b5 as X,b1 as P,b as R,ah as I,b3 as J,aw as K,b4 as W,bG as Y,bH as ee,aj as U}from"./index.172e2525.js";import{Q as se}from"./QForm.6fa35232.js";import{Q as ae}from"./QPage.5bce1de2.js";import{u as te}from"./use-quasar.56147a62.js";import{a as oe,e as re,c as $,d as le,b as de,u as Q}from"./array.7464b866.js";import{q as d,k as D}from"./quickbase.0e5ca545.js";import{c as ie}from"./carousel.0ac16c53.js";import"./_commonjsHelpers.d497b07e.js";import"./dayjs.38d40b2d.js";import"./localForage.482f4ef4.js";import"./index.7dbe61ef.js";import"./i18n.a8b0edb4.js";import"./use-panel.54d395ed.js";import"./touch.6a3c5155.js";import"./selection.791209b7.js";const ne=i=>(Y("data-v-17d8cafc"),i=i(),ee(),i),ce={key:0,class:"col-md-7 col-lg-8 col-lx-8"},ue={class:"col-xs-12 col-sm-12 col-md-5 col-lg-4 col-lx-4 row justify-center items-center"},pe=ne(()=>r("p",{class:"text-dark"},"Update Password",-1)),me={class:"row"},we={class:"row"},fe={class:"text-grey-6"},_e=U("Return to Login"),ge={class:"text-grey-6"},ve=U("Need an account? "),he=U("Register"),be={__name:"passwordUpdate",setup(i){const g=te(),q=O(),v=H(),h=k("update-password"),n=k(!1),L=T(()=>oe({userRID:re().required(),password:$().required().matches(/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d@$!%*#?&]{8,}$/,{excludeEmptyString:!0,message:"Must Contain at least 8 Characters, at least 1 Uppercase, 1 Lowercase, and 1 Number"}).nullable(),passwordConfirmation:$().oneOf([le("password"),null],"Passwords must match")})),{errors:xe,meta:N}=de({validationSchema:L,initialValues:{password:"",passwordConfirmation:""}}),{value:c}=Q("userRID"),{value:u,errorMessage:S,meta:j}=Q("password"),{value:b,errorMessage:V,meta:B}=Q("passwordConfirmation"),p=k(!0);q.query.rid?(c.value=q.query.rid,v.replace({query:{}})):v.push("/");const z=async()=>{if(!c.value||c.value==="")return!1;n.value=!0;const M=await d.isUserLoggedIn(),a=await D.genSalt(10),m=D.hashSync(u.value,a),o=new Date,A=[{3:{value:c.value},7:{value:m},26:{value:o}}];try{const{data:x}=await d.upsertRecordsXML({to:"br4pxrbs6",fieldsToReturn:[76],data:A,formatObject:76}),y=x[0][76];if(M){const C=Object.assign({},y);delete C.access,delete C.permissions,d.setUserPermissions(y.permissions,!0),d.setUserAccess(y.access,!0),await d.setUserInfo(C,!0)}else g.notify({position:"top-right",type:"info",message:"Login with new password!"});n.value=!1,v.push("/")}catch(x){n.value=!1,g.notify({position:"top-right",type:"negative",message:x.message||"Error updating password"})}};return(M,a)=>{const m=Z("router-link");return l(),w(ae,{class:"window-height window-width row"},{default:s(()=>[t(g).screen.lt.md?f("",!0):(l(),G("div",ce,[e(ie)])),r("div",ue,[e(W,{class:"auth-card",flat:""},{default:s(()=>[e(_,{style:{"padding-left":"30px","padding-right":"30px"}},{default:s(()=>[e(E,{src:"https://cdn.jsdelivr.net/gh/EliteHCMS/assets@latest/public/logo.svg",fit:"scale-down",class:"auth-logo full-width"})]),_:1}),e(_,{class:"text-center auth-description"},{default:s(()=>[pe]),_:1}),e(_,null,{default:s(()=>[e(se,{class:"q-px-sm q-pt-sm",onSubmit:a[3]||(a[3]=X(()=>{},["prevent"]))},{default:s(()=>[r("div",me,[h.value==="update-password"?(l(),w(P,{key:0,class:"col-xs-12",outlined:"",modelValue:t(u),"onUpdate:modelValue":a[1]||(a[1]=o=>R(u)?u.value=o:null),type:p.value?"password":"text",autocomplete:"current-password",label:"Password",tabindex:"1",error:!!(t(S)&&t(j).validated),"error-message":t(S)},{append:s(()=>[e(I,{name:p.value?"visibility_off":"visibility",class:"cursor-pointer",onClick:a[0]||(a[0]=o=>p.value=!p.value)},null,8,["name"])]),prepend:s(()=>[e(I,{name:"lock"})]),_:1},8,["modelValue","type","error","error-message"])):f("",!0)]),r("div",we,[h.value==="update-password"?(l(),w(P,{key:0,class:"col-xs-12",outlined:"",modelValue:t(b),"onUpdate:modelValue":a[2]||(a[2]=o=>R(b)?b.value=o:null),type:"password",autocomplete:"new-password",label:"Confirm Password",tabindex:"2",error:!!(t(V)&&t(B).validated),"error-message":t(V)},{prepend:s(()=>[e(I,{name:"lock"})]),_:1},8,["modelValue","error","error-message"])):f("",!0)])]),_:1})]),_:1}),e(J,{class:"q-px-lg"},{default:s(()=>[h.value==="update-password"?(l(),w(K,{key:0,loading:n.value,disable:!t(N).valid,unelevated:"",size:"lg",color:"primary",class:"full-width text-white",label:"Update Password",tabindex:"3",onClick:z},null,8,["loading","disable"])):f("",!0)]),_:1}),e(_,{class:"text-center q-pa-sm"},{default:s(()=>[r("p",fe,[e(m,{to:"/login",class:"text-grey-6",tabindex:"4"},{default:s(()=>[_e]),_:1})]),r("p",ge,[ve,e(m,{to:"/register",class:"text-grey-6",tabindex:"5"},{default:s(()=>[he]),_:1})])]),_:1})]),_:1})])]),_:1})}}};var je=F(be,[["__scopeId","data-v-17d8cafc"]]);export{je as default};
