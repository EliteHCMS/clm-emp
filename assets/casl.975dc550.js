var q=Object.defineProperty;var c=Object.getOwnPropertySymbols;var h=Object.prototype.hasOwnProperty,w=Object.prototype.propertyIsEnumerable;var d=(t,i,e)=>i in t?q(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e,m=(t,i)=>{for(var e in i||(i={}))h.call(i,e)&&d(t,e,i[e]);if(c)for(var e of c(i))w.call(i,e)&&d(t,e,i[e]);return t};import{f as I}from"./index.7b71c5b1.js";import{l as b}from"./index.ad94f8fd.js";import{z as v,a as y,q as a}from"./quickbase.b30588dc.js";import"./_commonjsHelpers.d497b07e.js";import"./dayjs.08f05e93.js";import"./localForage.ce4a5f27.js";import"./index.7dbe61ef.js";import"./i18n.b11063b9.js";const L=t=>t.matched.some(i=>y.can(i.meta.action||"read",i.meta.resource));var E=I(({app:t,router:i})=>{t.config.globalProperties.$subject=v,t.use(b,y,{useGlobalProperties:!0}),i.beforeEach(async(e,n,r)=>{const f=await a.isUserLoggedIn(),s=Object.assign({},e.query);if(f||a.logout(),s.office_id&&(a.setOfficeLocation({rid:s.office_id}),s.qr&&a.setCheckIn(!0)),n.fullPath==="/"&&!n.name&&f&&await a.reloadUserInfo({reAuthenticate:!0}),!L(e)){const g=e.path!=="/";return r(f?{name:"not-authorized"}:{name:"login",query:m({},g&&{redirect:e.path})})}if(e.meta.redirectIfLoggedIn&&f)return r("/");const l=await a.verifyRequired(),u=await a.employeeLinkRequired(),o=await a.getUserFromStore(),p=await a.getSocialRequired();if(l)return n.name==="code-confirmation"&&f&&e.query.code?(await a.setVerified(!0),r({path:"/"})):e.name!=="code-confirmation"?r({name:"code-confirmation",query:{p:o[9]?o[9].phoneNumber:o[8].replace(/[^0-9]/g,""),rid:o[3]}}):r();if(u||p)return n.name==="verify-identity"&&f&&e.query.verify?(e.query.rid?await a.setIdentityVerified(e.query.rid):await a.setIdentityVerified(!1),r({path:"/",query:{}})):e.name!=="verify-identity"?r({name:"verify-identity",query:{rid:o[3]}}):r();if(e.name==="verify-identity"){if(!u)return r({path:"/"})}else if(e.name==="code-confirmation")return!f&&e.query.ac?r():r({path:"/"});return r()}),i.afterEach(async(e,n)=>{const r=await a.isUserLoggedIn();n.fullPath==="/"&&!n.name&&r&&await a.updateStore({reAuthenticate:!1})})});export{E as default};
