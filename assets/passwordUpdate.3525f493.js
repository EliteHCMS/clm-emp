import{_ as E,bT as T,cW as j,bU as z,r as b,ac as F,c1 as O,d6 as W,c2 as P,d4 as X,c3 as Z,c4 as y,aT as H,g as l,ad as m,bd as a,V as t,h as G,al as e,ae as w,k as r,bO as g,c$ as J,bA as K,cy as S,D as U,bW as x,bX as Y,bV as ee,bQ as ae,aP as se,aN as te,ak as k,q as C,d5 as R}from"./index.2d58de3a.js";import{Q as oe}from"./QForm.0e69daf8.js";import{Q as re}from"./QPage.37fc11d1.js";import{c as le}from"./carousel.05d59302.js";import"./use-panel.635e7b44.js";import"./use-fullscreen.fdaf91e7.js";const de=d=>(se("data-v-24eb4a9c"),d=d(),te(),d),ie={key:0,class:"col-md-7 col-lg-8 col-lx-8"},ne={class:"col-xs-12 col-sm-12 col-md-5 col-lg-4 col-lx-4 row justify-center items-center"},ce=de(()=>r("p",{class:"text-dark"},"Update Password",-1)),ue={class:"row"},pe={class:"row"},me={class:"text-grey-6"},we=k("Return to Login"),ge={class:"text-grey-6"},fe=k("Need an account? "),_e=k("Register"),ve={__name:"passwordUpdate",setup(d){const f=T(),Q=j(),_=z(),v=b("update-password"),i=b(!1),$=F(()=>O({userRID:W().required(),password:P().required().matches(/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d@$!%*#?&]{8,}$/,{excludeEmptyString:!0,message:"Must Contain at least 8 Characters, at least 1 Uppercase, 1 Lowercase, and 1 Number"}).nullable(),passwordConfirmation:P().oneOf([X("password"),null],"Passwords must match")})),{errors:he,meta:D}=Z({validationSchema:$,initialValues:{password:"",passwordConfirmation:""}}),{value:n}=y("userRID"),{value:c,errorMessage:V,meta:L}=y("password"),{value:h,errorMessage:q,meta:N}=y("passwordConfirmation"),u=b(!0);Q.query.rid?(n.value=Q.query.rid,_.replace({query:{}})):_.push("/");const B=async()=>{if(!n.value||n.value==="")return!1;i.value=!0;const I=await C.isUserLoggedIn(),s=await R.genSalt(10),p=R.hashSync(c.value,s),o=new Date,M={3:{value:n.value},7:{value:p},26:{value:o}};try{I?await C.updateUserData({fields:M}):(await C.upsertRecordsXML({to:"br4pxrbs6",fieldsToReturn:[76],data:[M],formatObject:76}),f.notify({position:"top-right",type:"info",message:"Login with new password!"})),i.value=!1,_.push("/")}catch(A){i.value=!1,f.notify({position:"top-right",type:"negative",message:A.message||"Error updating password"})}};return(I,s)=>{const p=H("router-link");return l(),m(re,{class:"window-height window-width row"},{default:a(()=>[t(f).screen.lt.md?w("",!0):(l(),G("div",ie,[e(le)])),r("div",ne,[e(ae,{class:"auth-card",flat:""},{default:a(()=>[e(g,{style:{"padding-left":"30px","padding-right":"30px"}},{default:a(()=>[e(J,{src:"https://cdn.jsdelivr.net/gh/EliteHCMS/assets@latest/public/logo.svg",fit:"scale-down",class:"auth-logo full-width"})]),_:1}),e(g,{class:"text-center auth-description"},{default:a(()=>[ce]),_:1}),e(g,null,{default:a(()=>[e(oe,{class:"q-px-sm q-pt-sm",onSubmit:s[3]||(s[3]=K(()=>{},["prevent"]))},{default:a(()=>[r("div",ue,[v.value==="update-password"?(l(),m(S,{key:0,class:"col-xs-12",outlined:"",modelValue:t(c),"onUpdate:modelValue":s[1]||(s[1]=o=>U(c)?c.value=o:null),type:u.value?"password":"text",autocomplete:"current-password",label:"Password",tabindex:"1",error:!!(t(V)&&t(L).validated),"error-message":t(V)},{append:a(()=>[e(x,{name:u.value?"visibility_off":"visibility",class:"cursor-pointer",onClick:s[0]||(s[0]=o=>u.value=!u.value)},null,8,["name"])]),prepend:a(()=>[e(x,{name:"lock"})]),_:1},8,["modelValue","type","error","error-message"])):w("",!0)]),r("div",pe,[v.value==="update-password"?(l(),m(S,{key:0,class:"col-xs-12",outlined:"",modelValue:t(h),"onUpdate:modelValue":s[2]||(s[2]=o=>U(h)?h.value=o:null),type:"password",autocomplete:"new-password",label:"Confirm Password",tabindex:"2",error:!!(t(q)&&t(N).validated),"error-message":t(q)},{prepend:a(()=>[e(x,{name:"lock"})]),_:1},8,["modelValue","error","error-message"])):w("",!0)])]),_:1})]),_:1}),e(Y,{class:"q-px-lg"},{default:a(()=>[v.value==="update-password"?(l(),m(ee,{key:0,loading:i.value,disable:!t(D).valid,unelevated:"",size:"lg",color:"primary",class:"full-width text-white",label:"Update Password",tabindex:"3",onClick:B},null,8,["loading","disable"])):w("",!0)]),_:1}),e(g,{class:"text-center q-pa-sm"},{default:a(()=>[r("p",me,[e(p,{to:"/login",class:"text-grey-6",tabindex:"4"},{default:a(()=>[we]),_:1})]),r("p",ge,[fe,e(p,{to:"/register",class:"text-grey-6",tabindex:"5"},{default:a(()=>[_e]),_:1})])]),_:1})]),_:1})])]),_:1})}}};var Ve=E(ve,[["__scopeId","data-v-24eb4a9c"]]);export{Ve as default};
